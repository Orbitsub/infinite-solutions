<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinite Solutions - Market Inventory & Blueprints</title>
    <script src="bpc_pricing_data.js"></script>
    <script src="bpc_data.js"></script>
    <script src="research_jobs.js"></script>
    <script src="buyback_data.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&display=swap');

        body {
            margin: 0;
            padding: 2vh 2vw;
            background: #0a0a0a;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            font-family: 'Rajdhani', sans-serif;
        }

        .container {
            position: relative;
            transition: all 0.3s ease;
            max-width: none;
            margin: auto 0 2vh 0;
        }

        .container.expanded {
            margin: 0 0 2vh 0;
        }

        /* ============================================
           THUMBNAIL VIEW (Default)
           ============================================ */

        .thumbnail-view {
            display: none; /* Disabled - skip landing page */
            width: 400px;
            height: 225px;
            background: linear-gradient(135deg, #001a2e 0%, #002040 50%, #001530 100%);
            position: relative;
            overflow: hidden;
            border: 3px solid #00ffff;
            box-shadow:
                0 0 40px rgba(0, 255, 255, 0.6),
                inset 0 0 80px rgba(0, 150, 200, 0.2);
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .thumbnail-view:hover {
            transform: scale(1.02);
            box-shadow:
                0 0 50px rgba(0, 255, 255, 0.8),
                inset 0 0 80px rgba(0, 150, 200, 0.3);
        }

        .thumbnail-view .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(2px 2px at 15% 25%, white, transparent),
                radial-gradient(2px 2px at 85% 15%, white, transparent),
                radial-gradient(1px 1px at 45% 60%, white, transparent),
                radial-gradient(2px 2px at 75% 85%, white, transparent),
                radial-gradient(1px 1px at 30% 75%, white, transparent),
                radial-gradient(1px 1px at 60% 40%, white, transparent);
            opacity: 0.6;
        }

        .thumbnail-view .glow {
            position: absolute;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(0, 255, 255, 0.3) 0%, transparent 60%);
            top: -100px;
            right: -100px;
            filter: blur(40px);
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        .thumbnail-view .content {
            position: relative;
            z-index: 10;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            padding: 15px 25px 20px 25px;
            text-align: center;
        }

        .thumbnail-view .company-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 19px;
            font-weight: 900;
            color: #00ffff;
            text-transform: uppercase;
            letter-spacing: 4px;
            text-shadow:
                0 0 20px rgba(0, 255, 255, 1),
                0 0 40px rgba(0, 255, 255, 0.6),
                0 0 60px rgba(0, 255, 255, 0.4);
            margin: 0 0 5px 0;
            line-height: 1;
        }

        .thumbnail-view .tagline {
            font-family: 'Rajdhani', sans-serif;
            font-size: 12px;
            font-weight: 600;
            color: #66d9ff;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin: 0 0 12px 0;
        }

        .thumbnail-view .status-bar {
            background: rgba(0, 255, 255, 0.15);
            border: 2px solid #00ffff;
            border-radius: 8px;
            padding: 8px 16px;
            margin-bottom: 10px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
        }

        .thumbnail-view .status-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 13px;
            font-weight: 700;
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.8);
            margin: 0;
        }

        .thumbnail-view .info-row {
            display: flex;
            gap: 25px;
            justify-content: center;
        }

        .thumbnail-view .info-item {
            font-size: 12px;
            font-weight: 700;
            color: #99e6ff;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .thumbnail-view .info-value {
            color: #00ff88;
            font-size: 12px;
        }

        .click-hint {
            position: absolute;
            top: 10px;
            right: 15px;
            font-family: 'Rajdhani', sans-serif;
            font-size: 11px;
            color: #66d9ff;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.6;
            z-index: 20;
            animation: blink 2s ease-in-out infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.9; }
        }

        /* ============================================
           FULL INVENTORY VIEW - WITH TABS
           ============================================ */

        .inventory-view {
            display: block; /* Default view - landing page disabled */
            width: 96vw;
            max-width: none;
            background: linear-gradient(135deg, #0a1929 0%, #1a2332 50%, #0d1b2a 100%);
            position: relative;
            overflow: hidden;
            border: 2px solid #00d9ff;
            box-shadow:
                0 0 30px rgba(0, 217, 255, 0.3),
                inset 0 0 100px rgba(0, 100, 150, 0.1);
            padding: 0;
        }

        .inventory-view .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(2px 2px at 20% 30%, white, transparent),
                radial-gradient(2px 2px at 60% 70%, white, transparent),
                radial-gradient(1px 1px at 50% 50%, white, transparent),
                radial-gradient(1px 1px at 80% 10%, white, transparent),
                radial-gradient(2px 2px at 90% 60%, white, transparent),
                radial-gradient(1px 1px at 33% 80%, white, transparent);
            background-size: 200% 200%;
            opacity: 0.4;
        }

        .inventory-view .nebula {
            position: absolute;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(0, 217, 255, 0.15) 0%, transparent 70%);
            top: -150px;
            right: -150px;
            filter: blur(60px);
        }

        .inventory-view .grid {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image:
                linear-gradient(rgba(0, 217, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 217, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
        }

        /* Back button */
        .back-button {
            display: none; /* Disabled - skip landing page */
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 100;
            background: rgba(0, 217, 255, 0.2);
            border: 2px solid #00d9ff;
            color: #00ffff;
            font-family: 'Orbitron', sans-serif;
            font-size: 23px;
            font-weight: 700;
            padding: 12px 24px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-radius: 3px;
            box-shadow: 0 0 10px rgba(0, 217, 255, 0.4);
            transition: all 0.2s ease;
        }

        .back-button:hover {
            background: rgba(0, 217, 255, 0.3);
            box-shadow: 0 0 20px rgba(0, 217, 255, 0.6);
            transform: translateX(-2px);
        }

        /* ===== HEADER ===== */
        .header {
            background: linear-gradient(135deg, #001a2e 0%, #002040 50%, #001530 100%);
            padding: 30px;
            text-align: center;
            border-bottom: 3px solid #00ffff;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.4);
            position: relative;
            z-index: 10;
        }

        .header h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 50px;
            font-weight: 900;
            color: #00ffff;
            margin: 0 0 10px 0;
            text-transform: uppercase;
            letter-spacing: 6px;
            text-shadow:
                0 0 20px rgba(0, 255, 255, 1),
                0 0 40px rgba(0, 255, 255, 0.6),
                0 0 60px rgba(0, 255, 255, 0.4);
        }

        .header .tagline {
            font-size: 21px;
            color: #66d9ff;
            text-transform: uppercase;
            letter-spacing: 3px;
            font-weight: 600;
        }

        /* ===== MAIN TAB NAVIGATION ===== */
        .main-tabs {
            display: flex;
            justify-content: center;
            gap: 0;
            background: #0d1117;
            border-bottom: 2px solid #1a2332;
            padding: 0 20px;
            position: relative;
            z-index: 10;
        }

        .main-tab {
            padding: 20px 40px;
            font-family: 'Orbitron', sans-serif;
            font-size: 19px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            background: transparent;
            color: #66d9ff;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            position: relative;
        }

        .main-tab:hover {
            color: #00ffff;
            background: rgba(0, 255, 255, 0.05);
        }

        .main-tab.active {
            color: #00ffff;
            border-bottom: 3px solid #00ffff;
            background: rgba(0, 255, 255, 0.1);
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }

        /* ===== SUB TAB NAVIGATION ===== */
        .sub-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            background: #161b22;
            padding: 15px 20px;
            border-bottom: 1px solid #1a2332;
            position: relative;
            z-index: 10;
        }

        .sub-tab {
            padding: 12px 30px;
            font-family: 'Rajdhani', sans-serif;
            font-size: 17px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: rgba(0, 150, 200, 0.1);
            color: #99e6ff;
            border: 2px solid #1a4e66;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sub-tab:hover {
            background: rgba(0, 255, 255, 0.15);
            border-color: #00aacc;
            color: #00ffff;
        }

        .sub-tab.active {
            background: rgba(0, 255, 255, 0.2);
            border-color: #00ffff;
            color: #00ffff;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
        }

        /* ===== CONTENT CONTAINER ===== */
        .content {
            position: relative;
            z-index: 10;
            padding: 45px 50px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .section-header {
            font-family: 'Orbitron', sans-serif;
            font-size: 22px;
            font-weight: 700;
            line-height: 1.2;
            color: #00d9ff;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin: 30px 0 20px 0;
            padding: 12px 18px;
            background: rgba(0, 217, 255, 0.1);
            border-left: 4px solid #00d9ff;
            text-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
        }

        /* ===== INVENTORY GRID (4-column for materials) ===== */
        .item-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
            margin-bottom: 24px;
        }

        .moon-material-group {
            margin-bottom: 30px;
            padding-bottom: 25px;
            border-bottom: 1px solid rgba(0, 217, 255, 0.15);
        }

        .moon-material-group:last-of-type {
            border-bottom: none;
            padding-bottom: 0;
        }

        .item {
            background: rgba(0, 50, 80, 0.3);
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 6px;
            padding: 20px 22px;
            box-shadow: inset 0 0 15px rgba(0, 217, 255, 0.05);
        }

        .item-name {
            font-family: 'Rajdhani', sans-serif;
            font-size: 19px;
            font-weight: 600;
            line-height: 1.3;
            color: #ffffff;
            margin-bottom: 8px;
        }

        .item-details {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .detail-row {
            font-family: 'Rajdhani', sans-serif;
            font-size: 21px;
            line-height: 1.5;
            color: #88d0e8;
            display: flex;
            justify-content: space-between;
        }

        .detail-label {
            color: #6fb3d0;
        }

        .detail-value {
            color: #00ff99;
            font-weight: 600;
        }

        .out-of-stock {
            color: #ff6666 !important;
        }

        /* ===== BLUEPRINT TABLE SECTION ===== */
        .blueprint-section {
            margin-top: 40px;
            padding-top: 30px;
        }

        .filter-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-family: 'Rajdhani', sans-serif;
            font-size: 23px;
            color: #88e0ff;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .filter-group select,
        .filter-group input {
            font-family: 'Rajdhani', sans-serif;
            font-size: 23px;
            padding: 12px 16px;
            background: #0a3040;
            color: #00ffff;
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 4px;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #00d9ff;
            box-shadow: 0 0 10px rgba(0, 217, 255, 0.3);
        }

        /* Currently Researching Section */
        .research-section {
            margin-bottom: 30px;
            background: rgba(0, 100, 150, 0.1);
            border: 2px solid rgba(0, 217, 255, 0.4);
            border-radius: 8px;
            overflow: hidden;
        }

        .research-header {
            background: linear-gradient(135deg, #003050 0%, #004060 100%);
            padding: 20px 30px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid rgba(0, 217, 255, 0.3);
            transition: background 0.2s ease;
        }

        .research-header:hover {
            background: linear-gradient(135deg, #004060 0%, #005070 100%);
        }

        .research-header h3 {
            font-family: 'Orbitron', sans-serif;
            font-size: 19px;
            color: #00ffff;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 15px rgba(0, 255, 255, 0.6);
        }

        .research-toggle {
            font-size: 25px;
            color: #00ffff;
            transition: transform 0.3s ease;
        }

        .research-section.collapsed .research-toggle {
            transform: rotate(-90deg);
        }

        .research-content {
            padding: 20px 30px;
            max-height: 500px;
            overflow-y: auto;
            transition: max-height 0.3s ease, padding 0.3s ease;
        }

        .research-section.collapsed .research-content {
            max-height: 0;
            padding: 0 30px;
            overflow: hidden;
        }

        .research-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .research-job {
            background: rgba(0, 50, 80, 0.3);
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 6px;
            padding: 20px;
            transition: all 0.2s ease;
        }

        .research-job:hover {
            border-color: #00d9ff;
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.3);
            transform: translateY(-2px);
        }

        .research-job-name {
            font-family: 'Rajdhani', sans-serif;
            font-size: 23px;
            font-weight: 700;
            color: #00ffff;
            margin-bottom: 12px;
        }

        .research-job-detail {
            font-family: 'Rajdhani', sans-serif;
            font-size: 19px;
            color: #88e0ff;
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
        }

        .research-job-detail .label {
            color: #66b3cc;
        }

        .research-job-detail .value {
            color: #00ff88;
            font-weight: 600;
        }

        .research-countdown {
            font-family: 'Orbitron', sans-serif;
            font-size: 21px;
            color: #ffaa00;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(0, 217, 255, 0.2);
            text-align: center;
            font-weight: 700;
        }

        .no-research-jobs {
            font-family: 'Rajdhani', sans-serif;
            font-size: 21px;
            color: #66b3cc;
            text-align: center;
            padding: 40px;
            font-style: italic;
        }

        .blueprint-table-container {
            overflow-x: visible;
            margin-bottom: 20px;
            width: 100%;
        }

        /* Sub-tab navigation within Blueprint Library */
        .blueprint-subtabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid rgba(0, 217, 255, 0.2);
            padding-bottom: 5px;
        }

        .blueprint-subtab {
            background: transparent;
            border: none;
            color: #66d9ff;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            font-family: 'Rajdhani', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .blueprint-subtab:hover {
            color: #00ffff;
            background: rgba(0, 217, 255, 0.1);
        }

        .blueprint-subtab.active {
            color: #00ffff;
            border-bottom-color: #00d9ff;
            box-shadow: 0 2px 8px rgba(0, 217, 255, 0.3);
        }

        .blueprint-tab-content {
            display: none;
        }

        .blueprint-tab-content.active {
            display: block;
        }

        .blueprint-table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Rajdhani', sans-serif;
            table-layout: fixed;
        }

        /* Column widths for better distribution (8 columns) */
        .blueprint-table th:nth-child(1),
        .blueprint-table td:nth-child(1) {
            width: 28%; /* Blueprint Name */
        }

        .blueprint-table th:nth-child(2),
        .blueprint-table td:nth-child(2) {
            width: 13%; /* Category */
        }

        .blueprint-table th:nth-child(3),
        .blueprint-table td:nth-child(3) {
            width: 13%; /* Sub-Category */
        }

        .blueprint-table th:nth-child(4),
        .blueprint-table td:nth-child(4) {
            width: 7%; /* ME */
        }

        .blueprint-table th:nth-child(5),
        .blueprint-table td:nth-child(5) {
            width: 7%; /* TE */
        }

        .blueprint-table th:nth-child(6),
        .blueprint-table td:nth-child(6) {
            width: 9%; /* Quality */
        }

        .blueprint-table th:nth-child(7),
        .blueprint-table td:nth-child(7) {
            width: 12%; /* Price */
        }

        .blueprint-table th:nth-child(8),
        .blueprint-table td:nth-child(8) {
            width: 11%; /* Calculator */
            text-align: center;
        }

        /* BPC table column widths (10 columns - includes Runs and Qty) */
        #bpcTable th:nth-child(1), #bpcTable td:nth-child(1) { width: 24%; /* Name */ }
        #bpcTable th:nth-child(2), #bpcTable td:nth-child(2) { width: 11%; /* Category */ }
        #bpcTable th:nth-child(3), #bpcTable td:nth-child(3) { width: 11%; /* Sub-Category */ }
        #bpcTable th:nth-child(4), #bpcTable td:nth-child(4) { width: 6%;  /* ME */ }
        #bpcTable th:nth-child(5), #bpcTable td:nth-child(5) { width: 6%;  /* TE */ }
        #bpcTable th:nth-child(6), #bpcTable td:nth-child(6) { width: 7%;  /* Runs */ }
        #bpcTable th:nth-child(7), #bpcTable td:nth-child(7) { width: 6%;  /* Qty */ }
        #bpcTable th:nth-child(8), #bpcTable td:nth-child(8) { width: 8%;  /* Quality */ }
        #bpcTable th:nth-child(9), #bpcTable td:nth-child(9) { width: 10%; /* Price */ }
        #bpcTable th:nth-child(10) { width: 11%; /* Calculator */ text-align: center; }

        .blueprint-table thead {
            background: rgba(0, 217, 255, 0.1);
        }

        .blueprint-table th {
            font-size: 23px;
            font-weight: 700;
            line-height: 1.3;
            color: #00d9ff;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 18px 8px;
            text-align: left;
            border-bottom: 2px solid rgba(0, 217, 255, 0.3);
            cursor: pointer;
            user-select: none;
        }

        .blueprint-table th:hover {
            background: rgba(0, 217, 255, 0.15);
        }

        .blueprint-table td {
            font-size: 21px;
            line-height: 1.5;
            color: #ffffff;
            padding: 16px 8px;
            border-bottom: 1px solid rgba(0, 217, 255, 0.1);
        }

        .blueprint-table tr:hover {
            background: rgba(0, 217, 255, 0.05);
        }

        .footer {
            margin-top: 30px;
            padding-top: 25px;
            border-top: 2px solid rgba(0, 217, 255, 0.3);
            text-align: center;
            position: relative;
        }

        .footer-text {
            font-family: 'Rajdhani', sans-serif;
            font-size: 21px;
            line-height: 1.5;
            color: #88e0ff;
            margin-bottom: 6px;
        }

        .contact {
            font-family: 'Orbitron', sans-serif;
            font-size: 22px;
            color: #00d9ff;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
        }

        .disclaimer {
            font-family: 'Rajdhani', sans-serif;
            font-size: 17px;
            color: #6fb3d0;
            font-style: italic;
            margin-top: 10px;
            opacity: 0.8;
        }

        .last-updated {
            position: absolute;
            bottom: 25px;
            left: 50px;
            font-family: 'Rajdhani', sans-serif;
            font-size: 21px;
            color: #6fb3d0;
            font-style: italic;
        }

        /* Show/hide logic */
        .container.expanded .thumbnail-view {
            display: none;
        }

        .container.expanded .inventory-view {
            display: block;
        }

        /* ============================================
           RESPONSIVE DESIGN
           ============================================ */

        @media screen and (max-width: 1600px) {
            .inventory-view {
                max-width: 1500px;
            }

            .item-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media screen and (max-width: 1366px) {
            .inventory-view {
                max-width: 1300px;
            }

            .inventory-view .content {
                padding: 35px 40px;
            }
        }

        @media screen and (max-width: 768px) {
            body {
                padding: 10px;
            }

            .thumbnail-view {
                width: 100%;
                max-width: 400px;
                height: auto;
                min-height: 225px;
            }

            .inventory-view {
                width: 100%;
                max-width: 100%;
            }

            .inventory-view .content {
                padding: 50px 15px 20px 15px;
            }

            .header h1 {
                font-size: 22px;
            }

            .main-tab {
                padding: 15px 20px;
                font-size: 11px;
            }

            .sub-tab {
                padding: 10px 20px;
                font-size: 11px;
            }

            .item-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .last-updated {
                position: static;
                margin-top: 15px;
            }
        }

        /* BPC Calculator Styles */
        .calc-btn {
            background: linear-gradient(135deg, #00d9ff 0%, #0099cc 100%);
            color: #0a0f1a;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-weight: 700;
            cursor: pointer;
            font-size: 16px;
            font-family: 'Rajdhani', sans-serif;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .calc-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 217, 255, 0.5);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: linear-gradient(135deg, #0a0f1a 0%, #1a2332 100%);
            margin: 5% auto;
            padding: 0;
            border: 2px solid #00d9ff;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 8px 32px rgba(0, 217, 255, 0.3);
        }

        .modal-header {
            padding: 20px 25px;
            border-bottom: 2px solid rgba(0, 217, 255, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            color: #00d9ff;
            font-size: 25px;
            font-family: 'Orbitron', sans-serif;
        }

        .modal-close {
            color: #00d9ff;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
            transition: color 0.2s;
        }

        .modal-close:hover {
            color: #ff6b6b;
        }

        .modal-body {
            padding: 25px;
        }

        .calc-info {
            background: rgba(0, 100, 150, 0.2);
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .calc-info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
        }

        .calc-label {
            color: #00d9ff;
            font-weight: 600;
            font-size: 17px;
        }

        .calc-value {
            color: #ffffff;
            font-weight: 700;
            font-size: 18px;
        }

        .calc-inputs {
            margin-bottom: 25px;
        }

        .calc-input-group {
            margin-bottom: 15px;
        }

        .calc-input-group label {
            display: block;
            color: #00d9ff;
            font-weight: 600;
            font-size: 17px;
            margin-bottom: 12px;
        }

        .calc-input-group input {
            width: 100%;
            padding: 16px;
            background: rgba(0, 100, 150, 0.2);
            border: 2px solid rgba(0, 217, 255, 0.3);
            border-radius: 6px;
            color: #ffffff;
            font-size: 18px;
            font-weight: 600;
            transition: border-color 0.2s;
            box-sizing: border-box;
        }

        .calc-input-group input:focus {
            outline: none;
            border-color: #00d9ff;
            background: rgba(0, 100, 150, 0.3);
        }

        .calc-result {
            background: linear-gradient(135deg, rgba(0, 217, 255, 0.1) 0%, rgba(0, 100, 150, 0.1) 100%);
            border: 2px solid #00d9ff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .calc-result-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0, 217, 255, 0.2);
        }

        .calc-result-row:last-child {
            border-bottom: none;
        }

        .calc-result-row.total-price {
            padding-top: 15px;
            margin-top: 10px;
            border-top: 2px solid #00d9ff;
        }

        .calc-result-label {
            color: #00d9ff;
            font-weight: 600;
            font-size: 17px;
        }

        .calc-result-value {
            color: #00ff88;
            font-weight: 700;
            font-size: 21px;
        }

        .total-price .calc-result-value {
            font-size: 29px;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .calc-note {
            color: #ffaa00;
            font-size: 13px;
            font-style: italic;
            text-align: center;
            padding: 15px;
            background: rgba(255, 170, 0, 0.1);
            border-radius: 6px;
        }

        /* ============================================
           MOBILE RESPONSIVENESS
           ============================================ */

        /* Tablets and smaller (max-width: 1024px) */
        @media (max-width: 1024px) {
            .blueprint-table th {
                font-size: 11px;
                padding: 12px 6px;
            }

            .blueprint-table td {
                font-size: 13px;
                padding: 10px 6px;
            }

            .calc-btn {
                font-size: 12px;
                padding: 10px 16px;
            }

            /* Make research cards stack on tablets */
            .research-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }

        /* Mobile phones (max-width: 768px) */
        @media (max-width: 768px) {
            body {
                padding: 1vh 1vw;
            }

            h1 {
                font-size: 34px;
            }

            .tagline {
                font-size: 13px;
            }

            /* Tabs */
            .main-tab {
                font-size: 13px;
                padding: 15px 20px;
            }

            .sub-tab {
                font-size: 12px;
                padding: 12px 16px;
            }

            /* Blueprint table - smaller fonts */
            .blueprint-table th {
                font-size: 12px;
                padding: 10px 4px;
                letter-spacing: 0px;
            }

            .blueprint-table td {
                font-size: 11px;
                padding: 8px 4px;
            }

            /* Make table scrollable horizontally */
            .blueprint-table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            /* Adjust column widths for mobile */
            .blueprint-table th:nth-child(1),
            .blueprint-table td:nth-child(1) {
                min-width: 200px;
            }

            .blueprint-table th:nth-child(2),
            .blueprint-table td:nth-child(2),
            .blueprint-table th:nth-child(3),
            .blueprint-table td:nth-child(3) {
                min-width: 120px;
            }

            /* Calculate button */
            .calc-btn {
                font-size: 11px;
                padding: 8px 12px;
                white-space: nowrap;
            }

            /* Modal - make it nearly full screen on mobile */
            .modal-content {
                width: 95%;
                margin: 10px auto;
                max-height: 90vh;
                overflow-y: auto;
            }

            .modal-header h2 {
                font-size: 11px;
            }

            .modal-close {
                font-size: 25px;
            }

            .calc-label,
            .calc-input-group label {
                font-size: 11px;
            }

            .calc-value {
                font-size: 22px;
            }

            .calc-input-group input {
                font-size: 17px;
                padding: 14px;
            }

            .calc-result-label {
                font-size: 11px;
            }

            .calc-result-value {
                font-size: 17px;
            }

            .total-price .calc-result-value {
                font-size: 22px;
            }

            /* Research section */
            .research-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .research-header h3 {
                font-size: 11px;
            }

            /* Item grids */
            .item-grid {
                grid-template-columns: 1fr;
            }

            /* Footer */
            .last-updated {
                font-size: 12px;
            }

            .footer-text {
                font-size: 11px;
            }
        }

        /* Small phones (max-width: 480px) */
        @media (max-width: 480px) {
            h1 {
                font-size: 25px;
            }

            .tagline {
                font-size: 11px;
            }

            .main-tab {
                font-size: 12px;
                padding: 12px 15px;
            }

            .sub-tab {
                font-size: 11px;
                padding: 10px 12px;
            }

            .blueprint-table th {
                font-size: 11px;
                padding: 8px 3px;
            }

            .blueprint-table td {
                font-size: 12px;
                padding: 6px 3px;
            }

            .calc-btn {
                font-size: 12px;
                padding: 6px 10px;
            }

            .modal-header h2 {
                font-size: 17px;
            }

            .calc-label,
            .calc-input-group label {
                font-size: 13px;
            }

            .calc-value {
                font-size: 11px;
            }

            .calc-input-group input {
                font-size: 11px;
                padding: 12px;
            }

            .calc-result-label {
                font-size: 13px;
            }

            .calc-result-value {
                font-size: 11px;
            }

            .total-price .calc-result-value {
                font-size: 11px;
            }

            .calc-note {
                font-size: 11px;
            }

            /* Make research countdown smaller */
            .research-countdown {
                font-size: 17px;
            }
        }

        /* Landscape phones */
        @media (max-height: 600px) and (orientation: landscape) {
            .modal-content {
                max-height: 95vh;
                overflow-y: auto;
            }

            .modal-body {
                padding: 15px;
            }
        }

        /* Touch-friendly improvements */
        @media (hover: none) and (pointer: coarse) {
            /* Increase touch targets */
            .calc-btn {
                min-height: 44px;
                min-width: 100px;
            }

            .blueprint-table th,
            .blueprint-table td {
                padding: 12px 6px;
            }

            /* Make close button easier to tap */
            .modal-close {
                padding: 10px;
                min-width: 44px;
                min-height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }

        /* ============================================
           BUYBACK TAB STYLES
           ============================================ */

        /* Info card (sits in the rate-grid) */
        .buyback-info-card {
            background: linear-gradient(135deg, rgba(0, 50, 80, 0.4), rgba(0, 30, 50, 0.6));
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 6px;
            padding: 15px 18px;
            display: flex;
            flex-direction: column;
        }

        .buyback-info-card .rate-card-title {
            font-size: 15px;
            font-weight: 700;
            color: #00d9ff;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(0, 217, 255, 0.15);
        }

        .buyback-info-text {
            font-size: 15px;
            color: #88d0e8;
            line-height: 1.8;
            flex: 1;
        }

        .buyback-info-text strong {
            color: #00ffff;
        }

        .buyback-section-header {
            font-family: 'Orbitron', sans-serif;
            font-size: 20px;
            font-weight: 700;
            color: #00d9ff;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 217, 255, 0.2);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .rate-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .rate-card.category-hidden {
            display: none;
        }

        .rate-card {
            background: rgba(0, 50, 80, 0.2);
            border: 1px solid rgba(0, 217, 255, 0.2);
            border-radius: 6px;
            padding: 15px 18px;
            display: flex;
            flex-direction: column;
        }

        .rate-card-title {
            font-size: 15px;
            font-weight: 700;
            color: #00d9ff;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(0, 217, 255, 0.15);
        }

        .rate-card-items {
            flex: 1;
            max-height: 350px;
            overflow-y: auto;
            padding-right: 4px;
        }

        .rate-card-items::-webkit-scrollbar { width: 6px; }
        .rate-card-items::-webkit-scrollbar-track { background: rgba(0, 30, 50, 0.3); border-radius: 3px; }
        .rate-card-items::-webkit-scrollbar-thumb { background: rgba(0, 217, 255, 0.3); border-radius: 3px; }
        .rate-card-items::-webkit-scrollbar-thumb:hover { background: rgba(0, 217, 255, 0.5); }

        .rate-item {
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 217, 255, 0.05);
        }

        .rate-item:last-child { border-bottom: none; }

        .rate-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .rate-item-name { color: #88d0e8; font-size: 15px; }

        .rate-item-pct {
            font-size: 12px;
            font-weight: 700;
            color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.25);
            border-radius: 4px;
            padding: 2px 8px;
            letter-spacing: 0.5px;
        }

        .rate-item-pct.special {
            color: #ffaa00;
            background: rgba(255, 170, 0, 0.1);
            border-color: rgba(255, 170, 0, 0.25);
        }

        .rate-item-quota {
            font-size: 12px;
            color: #4a8aa0;
            margin-top: 2px;
            padding-left: 1px;
        }

        .rate-item-quota.urgent { color: #ff8844; font-weight: 600; }
        .rate-item-quota.full { color: #ff4444; font-weight: 700; }

        .rate-item.not-accepting { opacity: 0.35; }
        .rate-item.not-accepting .rate-item-pct { color: #666; }

        .not-accepting-badge {
            font-size: 11px;
            color: #ff6666;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        /* Paste input area */
        .buyback-input-area {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .buyback-paste-box {
            flex: 1;
            position: relative;
        }

        .buyback-paste-box textarea {
            width: 100%;
            height: 200px;
            background: #0a1520;
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 6px;
            color: #00ffff;
            font-family: 'Rajdhani', sans-serif;
            font-size: 16px;
            padding: 15px;
            resize: vertical;
            box-sizing: border-box;
        }

        .buyback-paste-box textarea::placeholder { color: #3a6a80; }

        .buyback-paste-box textarea:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
        }

        .paste-hint {
            position: absolute;
            bottom: 10px;
            right: 15px;
            font-size: 13px;
            color: #3a6a80;
            pointer-events: none;
        }

        .buyback-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            justify-content: flex-start;
            padding-top: 5px;
        }

        .btn-calculate {
            padding: 15px 30px;
            font-family: 'Orbitron', sans-serif;
            font-size: 16px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(0, 150, 200, 0.3));
            color: #00ffff;
            border: 2px solid #00d9ff;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-calculate:hover {
            background: linear-gradient(135deg, rgba(0, 217, 255, 0.3), rgba(0, 150, 200, 0.4));
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .btn-clear {
            padding: 10px 20px;
            font-family: 'Rajdhani', sans-serif;
            font-size: 15px;
            font-weight: 600;
            background: transparent;
            color: #6fb3d0;
            border: 1px solid #1a4e66;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-clear:hover { border-color: #ff6666; color: #ff6666; }

        /* Results table */
        .buyback-table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Rajdhani', sans-serif;
        }

        .buyback-table thead th {
            background: rgba(0, 50, 80, 0.5);
            color: #00d9ff;
            font-size: 16px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 14px 16px;
            text-align: left;
            border-bottom: 2px solid rgba(0, 217, 255, 0.3);
        }

        .buyback-table tbody tr {
            border-bottom: 1px solid rgba(0, 217, 255, 0.1);
            transition: background 0.2s;
        }

        .buyback-table tbody tr:hover { background: rgba(0, 217, 255, 0.05); }

        .buyback-table td {
            padding: 12px 16px;
            font-size: 16px;
            color: #c0e0f0;
        }

        .item-name-col { color: #ffffff; font-weight: 600; }
        .qty-col { color: #88d0e8; text-align: right; }
        .rate-col { color: #00d9ff; text-align: center; }
        .jita-col { color: #6fb3d0; text-align: right; }
        .payout-col { color: #00ff88; font-weight: 700; text-align: right; }
        .status-col { text-align: center; }
        .status-accepted { color: #00ff88; font-weight: 600; }
        .status-not-accepted { color: #ff6666; font-weight: 600; }
        .quota-col { text-align: right; color: #6fb3d0; }
        .quota-text { font-size: 13px; color: #6fb3d0; }
        .quota-text.over-limit { color: #ffaa00; font-weight: 600; }

        .buyback-table tbody tr.over-limit { border-left: 3px solid #ffaa00; }

        .over-limit-note {
            font-size: 13px;
            color: #ffaa00;
            font-style: italic;
            display: block;
            margin-top: 2px;
        }

        .qty-adjusted {
            color: #ffaa00;
            font-size: 13px;
            display: block;
            text-decoration: line-through;
            opacity: 0.6;
        }

        .qty-accepted { color: #00ff88; font-weight: 700; }

        /* Summary box */
        .buyback-summary {
            display: flex;
            justify-content: flex-end;
            gap: 30px;
            margin-top: 25px;
            padding: 20px 25px;
            background: rgba(0, 50, 80, 0.3);
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 6px;
        }

        .summary-item { text-align: right; }

        .summary-label {
            font-size: 14px;
            color: #6fb3d0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .summary-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 22px;
            font-weight: 700;
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.4);
        }

        .summary-value.items-count {
            color: #00d9ff;
            text-shadow: 0 0 10px rgba(0, 217, 255, 0.4);
        }

        /* Share quote link */
        .quote-share-section {
            margin-top: 25px;
            padding: 20px 25px;
            background: linear-gradient(135deg, rgba(0, 100, 50, 0.15), rgba(0, 60, 30, 0.25));
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 6px;
        }

        .quote-share-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .quote-share-header .icon { font-size: 20px; color: #00ff88; }

        .quote-share-header .title {
            font-family: 'Orbitron', sans-serif;
            font-size: 15px;
            font-weight: 700;
            color: #00ff88;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .quote-share-description {
            font-size: 15px;
            color: #6fb3d0;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .quote-link-row {
            display: flex;
            gap: 10px;
            align-items: stretch;
        }

        .quote-link-input {
            flex: 1;
            background: #0a1520;
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 6px;
            color: #00ffff;
            font-family: 'Rajdhani', sans-serif;
            font-size: 14px;
            padding: 12px 15px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .quote-link-input:focus {
            outline: none;
            border-color: #00ff88;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.2);
        }

        .btn-copy-link {
            padding: 12px 24px;
            font-family: 'Orbitron', sans-serif;
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 200, 100, 0.3));
            color: #00ff88;
            border: 2px solid rgba(0, 255, 136, 0.5);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .btn-copy-link:hover {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.3), rgba(0, 200, 100, 0.4));
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }

        .btn-copy-link.copied {
            background: rgba(0, 255, 136, 0.4);
            color: #ffffff;
        }

        .quote-id-display {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 12px;
        }

        .quote-id-label {
            font-size: 13px;
            color: #4a8aa0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .quote-id-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            font-weight: 700;
            color: #00d9ff;
            letter-spacing: 2px;
        }

        .quote-timestamp {
            font-size: 13px;
            color: #4a8aa0;
            margin-left: auto;
        }

        /* Loaded from link banner */
        .quote-loaded-banner {
            background: linear-gradient(135deg, rgba(0, 100, 200, 0.15), rgba(0, 60, 120, 0.25));
            border: 2px solid rgba(0, 217, 255, 0.4);
            border-radius: 8px;
            padding: 15px 25px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .quote-loaded-banner .icon { font-size: 22px; color: #00d9ff; }
        .quote-loaded-banner .text { font-size: 16px; color: #88d0e8; }
        .quote-loaded-banner .text strong { color: #00ffff; }
        .quote-loaded-banner .recalc-note {
            font-size: 13px;
            color: #00ff88;
            margin-left: auto;
            font-style: italic;
        }

        .buyback-results { display: none; }
        .buyback-results.visible { display: block; }
    </style>
</head>
<body>
    <div class="container" id="container">
        <!-- THUMBNAIL VIEW -->
        <div class="thumbnail-view" onclick="expandInventory()">
            <div class="stars"></div>
            <div class="glow"></div>
            <div class="content">
                <h1 class="company-name">INFINITE<br/>SOLUTIONS</h1>
                <div class="tagline">Materials and Resources</div>
                <div class="status-bar">
                    <div class="status-text">MARKET OPEN</div>
                </div>
                <div class="info-row">
                    <div class="info-item"><span class="info-value">97-98%</span> JBV</div>
                    <div class="info-item"><span class="info-value">35</span> Items</div>
                    <div class="info-item">LX-ZOJ</div>
                </div>
            </div>
            <div class="click-hint">Click for details</div>
        </div>

        <!-- FULL INVENTORY VIEW WITH TABS -->
        <div class="inventory-view">
            <button class="back-button" onclick="collapseInventory()"> Back</button>
            <div class="stars"></div>
            <div class="nebula"></div>
            <div class="grid"></div>

            <!-- HEADER -->
            <div class="header">
                <h1>INFINITE SOLUTIONS</h1>
                <div class="tagline">Materials, Resources & Manufacturing</div>
            </div>

            <!-- MAIN TAB NAVIGATION -->
            <div class="main-tabs">
                <button class="main-tab active" onclick="showMainTab('market')">Materials & Resources Market</button>
                <button class="main-tab" onclick="showMainTab('blueprints')">Blueprint Library</button>
                <button class="main-tab" onclick="showMainTab('buyback')">Buyback Program</button>
            </div>

            <!-- ========================================
                 MARKET TAB CONTENT
                 ======================================== -->
            <div id="market-tab" class="tab-content active">
                <!-- SUB TABS -->
                <div class="sub-tabs">
                    <button class="sub-tab active" onclick="showSubTab('minerals')">Minerals</button>
                    <button class="sub-tab" onclick="showSubTab('ice')">Ice Products</button>
                    <button class="sub-tab" onclick="showSubTab('moon')">Moon Materials</button>
                </div>

                <div class="content">
                    <!-- MINERALS SUB-CONTENT -->
                    <div id="minerals-content" class="tab-content active">
                        <div class="item-grid" id="minerals-grid"></div>
                    </div>

                    <!-- ICE PRODUCTS SUB-CONTENT -->
                    <div id="ice-content" class="tab-content">
                        <div class="item-grid" id="ice-grid"></div>
                    </div>

                    <!-- MOON MATERIALS SUB-CONTENT -->
                    <div id="moon-content" class="tab-content">
                        <div id="moon-materials"></div>
                    </div>

                    <div class="footer">
                        <div class="last-updated" id="lastUpdated">Loading...</div>
                        <div class="footer-text">DM <span class="contact">@Hamektok</span> for bulk contracts</div>
                        <div class="disclaimer">All mineral estimates are subject to change</div>
                    </div>
                </div>
            </div>

            <!-- ========================================
                 BLUEPRINT LIBRARY TAB CONTENT
                 ======================================== -->
            <div id="blueprints-tab" class="tab-content">
                <div class="content">
                    <!-- CURRENTLY RESEARCHING SECTION -->
                    <div class="research-section" id="researchSection" style="display: none;">
                        <div class="research-header" onclick="toggleResearchSection()">
                            <h3>Currently Researching</h3>
                            <span class="research-toggle"></span>
                        </div>
                        <div class="research-content">
                            <div class="research-grid" id="researchGrid">
                                <!-- Research jobs will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- BPO/BPC SUB-TABS -->
                    <div class="blueprint-subtabs">
                        <button class="blueprint-subtab active" onclick="showBlueprintTab('bpo')">
                            Blueprint Originals (BPOs)
                        </button>
                        <button class="blueprint-subtab" onclick="showBlueprintTab('bpc')">
                            Blueprint Copies (BPCs)
                        </button>
                    </div>

                    <!-- BPO TAB CONTENT -->
                    <div id="bpo-tab-content" class="blueprint-tab-content active">
                        <!-- SEARCH AND FILTER CONTROLS -->
                        <div class="filter-controls">
                        <div class="filter-group">
                            <label>Search:</label>
                            <input type="text" id="searchFilter" placeholder="Blueprint name...">
                        </div>
                        <div class="filter-group">
                            <label>Category:</label>
                            <select id="categoryFilter">
                                <option value="">All Categories</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Sub-Category:</label>
                            <select id="subcategoryFilter">
                                <option value="">All Sub-Categories</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Research Status:</label>
                            <select id="researchFilter">
                                <option value="">All</option>
                                <option value="perfect">Perfect (ME10/TE20)</option>
                                <option value="partial">Partial</option>
                                <option value="none">No Research</option>
                            </select>
                        </div>
                    </div>

                    <!-- BLUEPRINT TABLE -->
                    <div class="blueprint-table-container">
                        <table class="blueprint-table" id="blueprintTable">
                            <thead>
                                <tr>
                                    <th onclick="sortTable(0)">Blueprint Name</th>
                                    <th onclick="sortTable(1)">Category</th>
                                    <th onclick="sortTable(2)">Sub-Category</th>
                                    <th onclick="sortTable(3)">ME</th>
                                    <th onclick="sortTable(4)">TE</th>
                                    <th onclick="sortTable(5)">Quality</th>
                                    <th onclick="sortTable(6)">Price (10 runs)</th>
                                    <th>Calculator</th>
                                </tr>
                            </thead>
                            <tbody id="blueprintTableBody"></tbody>
                        </table>
                    </div>
                    </div><!-- End BPO tab content -->

                    <!-- BPC TAB CONTENT -->
                    <div id="bpc-tab-content" class="blueprint-tab-content" style="display: none;">
                        <!-- BPC SEARCH AND FILTER CONTROLS -->
                        <div class="filter-controls">
                            <div class="filter-group">
                                <label>Search:</label>
                                <input type="text" id="searchFilterBPC" placeholder="Blueprint name..." oninput="applyBPCFilters()">
                            </div>
                            <div class="filter-group">
                                <label>Category:</label>
                                <select id="categoryFilterBPC" onchange="updateSubcategoryFilterBPC(); applyBPCFilters()">
                                    <option value="">All Categories</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Sub-Category:</label>
                                <select id="subcategoryFilterBPC" onchange="applyBPCFilters()">
                                    <option value="">All Sub-Categories</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Runs:</label>
                                <select id="runsFilterBPC" onchange="applyBPCFilters()">
                                    <option value="">All Runs</option>
                                    <option value="1-10">1-10 runs</option>
                                    <option value="11-50">11-50 runs</option>
                                    <option value="51-100">51-100 runs</option>
                                    <option value="101+">101+ runs</option>
                                </select>
                            </div>
                        </div>

                        <!-- BPC TABLE -->
                        <div class="blueprint-table-container">
                            <table class="blueprint-table" id="bpcTable">
                                <thead>
                                    <tr>
                                        <th onclick="sortBPCTable(0)">Blueprint Name</th>
                                        <th onclick="sortBPCTable(1)">Category</th>
                                        <th onclick="sortBPCTable(2)">Sub-Category</th>
                                        <th onclick="sortBPCTable(3)">ME</th>
                                        <th onclick="sortBPCTable(4)">TE</th>
                                        <th onclick="sortBPCTable(5)">Runs</th>
                                        <th onclick="sortBPCTable(6)">Qty</th>
                                        <th onclick="sortBPCTable(7)">Quality</th>
                                        <th onclick="sortBPCTable(8)">Price</th>
                                        <th>Calculator</th>
                                    </tr>
                                </thead>
                                <tbody id="bpcTableBody">
                                    <!-- BPC rows will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div><!-- End BPC tab content -->

                    <div class="footer">
                        <div class="last-updated" id="lastUpdated2">Loading...</div>
                        <div class="footer-text">DM <span class="contact">@Hamektok</span> for bulk contracts</div>
                        <div class="disclaimer">All mineral estimates are subject to change</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- BPC CALCULATOR MODAL -->
        <div id="bpcCalculatorModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="calcModalTitle">BPC Cost Calculator</h2>
                    <span class="modal-close" onclick="closeCalculator()">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="calc-info">
                        <div class="calc-info-row">
                            <span class="calc-label">Quality:</span>
                            <span class="calc-value" id="calcQuality">-</span>
                        </div>
                        <div class="calc-info-row">
                            <span class="calc-label">Jita Sell Price:</span>
                            <span class="calc-value" id="calcJitaPrice">-</span>
                        </div>
                    </div>

                    <div class="calc-inputs">
                        <div class="calc-input-group">
                            <label for="calcRuns">Runs per Copy:</label>
                            <input type="number" id="calcRuns" value="10" min="1" max="300" onchange="calculatePrice()">
                        </div>
                        <div class="calc-input-group">
                            <label for="calcCopies">Number of Copies:</label>
                            <input type="number" id="calcCopies" value="1" min="1" max="100" onchange="calculatePrice()">
                        </div>
                    </div>

                    <div class="calc-result">
                        <div class="calc-result-row">
                            <span class="calc-result-label">Total Runs:</span>
                            <span class="calc-result-value" id="calcTotalRuns">10</span>
                        </div>
                        <div class="calc-result-row total-price">
                            <span class="calc-result-label">Total Price:</span>
                            <span class="calc-result-value" id="calcTotalPrice">-</span>
                        </div>
                        <div class="calc-result-row">
                            <span class="calc-result-label">Price per Run:</span>
                            <span class="calc-result-value" id="calcPricePerRun">-</span>
                        </div>
                    </div>

                    <div class="calc-note">
                        <strong>Note:</strong> Prices include facility bonuses (Azbel in LX-ZOJ) and quality adjustment based on ME/TE levels.
                    </div>
                </div>
            </div>
        </div>

        <!-- ========================================
             BUYBACK TAB CONTENT
             ======================================== -->
        <div id="buyback-tab" class="tab-content">
            <div class="content">

                <!-- What We're Buying - Rates -->
                <div class="buyback-section-header">What We're Buying</div>

                <div class="rate-grid" id="buybackRateGrid">
                    <!-- Program Info card -->
                    <div class="buyback-info-card">
                        <div class="rate-card-title">Program Details</div>
                        <div class="buyback-info-text">
                            Sell your <strong>minerals, ice products, and reaction materials</strong> directly to Infinite Solutions.<br><br>
                            Rates based on <strong>7-day average Jita buy value</strong>  stable and resistant to market manipulation.<br><br>
                            Contract to <strong>Rax Hakaari</strong> at the <strong>LX-ZOJ Tatara</strong>.<br><br>
                            Payouts within <strong>24 hours</strong>.
                        </div>
                    </div>
                    <!-- Category cards rendered dynamically by JS -->
                </div>

                <!-- Paste & Calculate -->
                <div class="buyback-section-header" style="margin-top: 35px;">Instant Quote Calculator</div>

                <div class="buyback-input-area">
                    <div class="buyback-paste-box">
                        <textarea id="buybackPasteInput" placeholder="Paste your inventory here...

Example:
Tritanium    1,000,000
Pyerite      500,000
Mexallon     250,000
Heavy Water  50,000

Tip: Copy directly from EVE inventory window"></textarea>
                        <div class="paste-hint">Ctrl+V to paste from EVE</div>
                    </div>
                    <div class="buyback-actions">
                        <button class="btn-calculate" onclick="calculateBuybackQuote()">Calculate Quote</button>
                        <button class="btn-clear" onclick="clearBuybackInput()">Clear</button>
                    </div>
                </div>

                <!-- Loaded from link banner -->
                <div class="quote-loaded-banner" id="buybackLoadedBanner" style="display: none;">
                    <div class="icon">&#128279;</div>
                    <div class="text">
                        Quote loaded from shared link - Quote ID: <strong id="buybackLoadedQuoteId">--</strong>
                    </div>
                    <div class="recalc-note">Prices recalculated with current Jita rates</div>
                </div>

                <!-- Results -->
                <div class="buyback-results" id="buybackResults">
                    <div class="buyback-section-header">Quote Results</div>

                    <table class="buyback-table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th style="text-align:right;">Quantity</th>
                                <th style="text-align:center;">Rate</th>
                                <th style="text-align:right;">Jita Buy (7d avg)</th>
                                <th style="text-align:right;">Your Payout</th>
                                <th style="text-align:center;">Status</th>
                            </tr>
                        </thead>
                        <tbody id="buybackResultsBody"></tbody>
                    </table>

                    <div class="buyback-summary" id="buybackSummary"></div>

                    <!-- Share Quote Link -->
                    <div class="quote-share-section" id="buybackShareSection">
                        <div class="quote-share-header">
                            <div class="icon">&#128279;</div>
                            <div class="title">Share This Quote</div>
                        </div>
                        <div class="quote-share-description">
                            Copy this link and send it to <strong style="color:#00ffff;">@Rax Hakaari</strong> for verification.
                            The link contains your items and quantities  prices are recalculated fresh when opened.
                        </div>
                        <div class="quote-link-row">
                            <input type="text" class="quote-link-input" id="buybackQuoteLinkInput" readonly onclick="this.select()">
                            <button class="btn-copy-link" id="buybackCopyLinkBtn" onclick="copyBuybackQuoteLink()">Copy Link</button>
                        </div>
                        <div class="quote-id-display">
                            <span class="quote-id-label">Quote ID:</span>
                            <span class="quote-id-value" id="buybackQuoteId">--</span>
                            <span class="quote-timestamp" id="buybackQuoteTimestamp"></span>
                        </div>
                    </div>
                </div>

                <div class="footer" style="text-align:center; margin-top:40px; padding-top:20px; border-top:1px solid rgba(0,217,255,0.1);">
                    <div style="font-size:16px; color:#4a8aa0;">Contract items to <span style="color:#00d9ff; font-weight:600;">Rax Hakaari</span> at <span style="color:#00d9ff; font-weight:600;">LX-ZOJ Tatara</span> | Payouts within 24 hours</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // EMBEDDED DATA
        // ============================================
        const EMBEDDED_DATA = {
            "inventory": {
                        "Tritanium": 137369941,
                        "Pyerite": 82211603,
                        "Isogen": 2457425,
                        "Mexallon": 6665761,
                        "Nocxium": 0,
                        "Zydrine": 563202,
                        "Megacyte": 72597,
                        "Morphite": 133,
                        "Heavy Water": 347760,
                        "Liquid Ozone": 522804,
                        "Strontium Clathrates": 906,
                        "Oxygen Isotopes": 110777,
                        "Hydrogen Isotopes": 148297,
                        "Helium Isotopes": 375200,
                        "Nitrogen Isotopes": 0,
                        "Atmospheric Gases": 98258,
                        "Evaporite Deposits": 129928,
                        "Hydrocarbons": 8771,
                        "Silicates": 103517,
                        "Cobalt": 0,
                        "Scandium": 18,
                        "Tungsten": 14446,
                        "Titanium": 5952,
                        "Chromium": 7223,
                        "Cadmium": 2419,
                        "Platinum": 9,
                        "Vanadium": 0,
                        "Technetium": 0,
                        "Mercury": 0,
                        "Caesium": 0,
                        "Hafnium": 5509,
                        "Promethium": 19,
                        "Neodymium": 15890,
                        "Dysprosium": 0,
                        "Thulium": 5322
            },
            "blueprintsLastUpdated": "Feb 16, 2026 08:00 EVE",
            "inventoryLastUpdated": "Feb 17, 2026 06:08 EVE"
};

        let BLUEPRINT_DATA = [
            {
                        "name": "720mm Howitzer Artillery I Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Modules",
                        "subcategory": "Weapon Modules"
            },
            {
                        "name": "Acolyte EV-300 Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Drones",
                        "subcategory": "Combat Utility Drones"
            },
            {
                        "name": "Acolyte I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Drones",
                        "subcategory": "Drones"
            },
            {
                        "name": "Acolyte TD-300 Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Drones",
                        "subcategory": "Electronic Warfare Drones"
            },
            {
                        "name": "Active Shielding Charge Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Command Burst Charge"
            },
            {
                        "name": "Algos Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Ships",
                        "subcategory": "Destroyer"
            },
            {
                        "name": "Antimatter Charge L Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Hybrid Charges"
            },
            {
                        "name": "Antimatter Charge S Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Hybrid Charges"
            },
            {
                        "name": "Antimatter Charge XL Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Hybrid Charges"
            },
            {
                        "name": "Antimatter Reactor Unit Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Components",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "Arbitrator Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ships",
                        "subcategory": "Cruiser"
            },
            {
                        "name": "Armor Energizing Charge Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Command Burst Charge"
            },
            {
                        "name": "Armor Reinforcement Charge Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Command Burst Charge"
            },
            {
                        "name": "Augoror Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ships",
                        "subcategory": "Cruiser"
            },
            {
                        "name": "Berserker SW-900 Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Drones",
                        "subcategory": "Electronic Warfare Drones"
            },
            {
                        "name": "Berserker TP-900 Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Drones",
                        "subcategory": "Electronic Warfare Drones"
            },
            {
                        "name": "Blackbird Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ships",
                        "subcategory": "Cruiser"
            },
            {
                        "name": "Bomb Launcher I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Modules",
                        "subcategory": "Torpedoes & Bombs"
            },
            {
                        "name": "Caesarium Cadmide Reaction Formula",
                        "me": 0,
                        "te": 0,
                        "category": "Reactions",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "Caldari Shuttle Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Ships",
                        "subcategory": "Shuttle"
            },
            {
                        "name": "Cap Booster 150 Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Modules",
                        "subcategory": "Capacitor Modules"
            },
            {
                        "name": "Caracal Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ships",
                        "subcategory": "Cruiser"
            },
            {
                        "name": "Carbon Fiber Reaction Formula",
                        "me": 0,
                        "te": 0,
                        "category": "Reactions",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "Carbonized Lead L Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Projectile Charges"
            },
            {
                        "name": "Carbonized Lead M Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Projectile Charges"
            },
            {
                        "name": "Catalyst Blueprint",
                        "me": 8,
                        "te": 0,
                        "category": "Ships",
                        "subcategory": "Destroyer"
            },
            {
                        "name": "Coercer Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Ships",
                        "subcategory": "Destroyer"
            },
            {
                        "name": "Coherent Asteroid Mining Crystal Type A I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Mining Crystal"
            },
            {
                        "name": "Combat Scanner Probe I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Scan Probe"
            },
            {
                        "name": "Complex Asteroid Mining Crystal Type A I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Mining Crystal"
            },
            {
                        "name": "Core Probe Launcher I Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Modules",
                        "subcategory": "Scanning Modules"
            },
            {
                        "name": "Core Scanner Probe I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Scan Probe"
            },
            {
                        "name": "Cormorant Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ships",
                        "subcategory": "Destroyer"
            },
            {
                        "name": "Crucifier Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ships",
                        "subcategory": "Frigate"
            },
            {
                        "name": "Damage Control I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Modules",
                        "subcategory": "Hull & Armor Modules"
            },
            {
                        "name": "Data Analyzer I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Modules",
                        "subcategory": "Scanning Modules"
            },
            {
                        "name": "Depleted Uranium L Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Projectile Charges"
            },
            {
                        "name": "Depleted Uranium M Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Projectile Charges"
            },
            {
                        "name": "Drake Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ships",
                        "subcategory": "Battlecruiser"
            },
            {
                        "name": "Drone Damage Amplifier I Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Modules",
                        "subcategory": "Drone Modules"
            },
            {
                        "name": "Dysporite Reaction Formula",
                        "me": 0,
                        "te": 0,
                        "category": "Reactions",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "ECCM Script Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Scripts"
            },
            {
                        "name": "EM Pulse Generator Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Components",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "EMP L Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Projectile Charges"
            },
            {
                        "name": "EMP M Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Projectile Charges"
            },
            {
                        "name": "Einherji I Blueprint",
                        "me": 10,
                        "te": 14,
                        "category": "Drones",
                        "subcategory": "Fighters"
            },
            {
                        "name": "Electronic Hardening Charge Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Command Burst Charge"
            },
            {
                        "name": "Electronic Superiority Charge Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Command Burst Charge"
            },
            {
                        "name": "Epithal Blueprint",
                        "me": 9,
                        "te": 0,
                        "category": "Ships",
                        "subcategory": "Hauler"
            },
            {
                        "name": "Evasive Maneuvers Charge Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Command Burst Charge"
            },
            {
                        "name": "Exequror Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ships",
                        "subcategory": "Cruiser"
            },
            {
                        "name": "Expanded Probe Launcher I Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Modules",
                        "subcategory": "Scanning Modules"
            },
            {
                        "name": "Fermionic Condensates Reaction Formula",
                        "me": 0,
                        "te": 0,
                        "category": "Reactions",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "Fluxed Condensates Reaction Formula",
                        "me": 0,
                        "te": 0,
                        "category": "Reactions",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "Fusion L Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Projectile Charges"
            },
            {
                        "name": "Fusion M Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Projectile Charges"
            },
            {
                        "name": "Fusion S Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Projectile Charges"
            },
            {
                        "name": "Fusion Thruster Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Components",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "Gallente Shuttle Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Ships",
                        "subcategory": "Shuttle"
            },
            {
                        "name": "Gravimetric Sensor Cluster Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Components",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "Graviton Reactor Unit Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Components",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "Griffin Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Ships",
                        "subcategory": "Frigate"
            },
            {
                        "name": "Hammerhead SD-600 Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Drones",
                        "subcategory": "Electronic Warfare Drones"
            },
            {
                        "name": "Heavy Armor Maintenance Bot I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Drones",
                        "subcategory": "Logistics Drones"
            },
            {
                        "name": "Heavy Hull Maintenance Bot I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Drones",
                        "subcategory": "Logistics Drones"
            },
            {
                        "name": "Heavy Shield Maintenance Bot I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Drones",
                        "subcategory": "Logistics Drones"
            },
            {
                        "name": "Helium Fuel Block Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Components",
                        "subcategory": "Fuel Blocks"
            },
            {
                        "name": "Heron Blueprint",
                        "me": 10,
                        "te": 16,
                        "category": "Ships",
                        "subcategory": "Frigate"
            },
            {
                        "name": "Hobgoblin I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Drones",
                        "subcategory": "Drones"
            },
            {
                        "name": "Hobgoblin SD-300 Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Drones",
                        "subcategory": "Electronic Warfare Drones"
            },
            {
                        "name": "Hornet EC-300 Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Drones",
                        "subcategory": "Electronic Warfare Drones"
            },
            {
                        "name": "Hurricane Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ships",
                        "subcategory": "Battlecruiser"
            },
            {
                        "name": "Hydrogen Fuel Block Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Components",
                        "subcategory": "Fuel Blocks"
            },
            {
                        "name": "Imicus Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Ships",
                        "subcategory": "Frigate"
            },
            {
                        "name": "Inferno Cruise Missile Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Missiles"
            },
            {
                        "name": "Inferno Heavy Assault Missile Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Missiles"
            },
            {
                        "name": "Inferno Heavy Missile Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Missiles"
            },
            {
                        "name": "Inferno Light Missile Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Missiles"
            },
            {
                        "name": "Inferno Rocket Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Rockets"
            },
            {
                        "name": "Inferno Torpedo Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Torpedoes & Bombs"
            },
            {
                        "name": "Infiltrator EV-600 Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Drones",
                        "subcategory": "Combat Utility Drones"
            },
            {
                        "name": "Infiltrator I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Drones",
                        "subcategory": "Drones"
            },
            {
                        "name": "Infiltrator TD-600 Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Drones",
                        "subcategory": "Electronic Warfare Drones"
            },
            {
                        "name": "Interdiction Maneuvers Charge Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Command Burst Charge"
            },
            {
                        "name": "Iridium Charge L Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Hybrid Charges"
            },
            {
                        "name": "Iridium Charge XL Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Hybrid Charges"
            },
            {
                        "name": "Iron Charge S Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Hybrid Charges"
            },
            {
                        "name": "Kestrel Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Ships",
                        "subcategory": "Frigate"
            },
            {
                        "name": "Large Algid Energy Administrations Unit I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Energy Weapon Rigs"
            },
            {
                        "name": "Large Algid Hybrid Administrations Unit I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Hybrid Weapon Rigs"
            },
            {
                        "name": "Large Ancillary Current Router I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Engineer Rigs"
            },
            {
                        "name": "Large Auxiliary Nano Pump I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Armor Rigs"
            },
            {
                        "name": "Large Auxiliary Thrusters I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Astronautics Rigs"
            },
            {
                        "name": "Large Bay Loading Accelerator I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Missile Launcher Rigs"
            },
            {
                        "name": "Large Capacitor Control Circuit I Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Engineer Rigs"
            },
            {
                        "name": "Large Cargohold Optimization I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Astronautics Rigs"
            },
            {
                        "name": "Large Core Defense Capacitor Safeguard I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Shield Rigs"
            },
            {
                        "name": "Large Core Defense Charge Economizer I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Shield Rigs"
            },
            {
                        "name": "Large Core Defense Field Extender I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Shield Rigs"
            },
            {
                        "name": "Large Core Defense Field Purger I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Shield Rigs"
            },
            {
                        "name": "Large Core Defense Operational Solidifier I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Shield Rigs"
            },
            {
                        "name": "Large Drone Control Range Augmentor I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Drone Rigs"
            },
            {
                        "name": "Large Drone Durability Enhancer I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Drone Rigs"
            },
            {
                        "name": "Large Drone Mining Augmentor I Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Drone Rigs"
            },
            {
                        "name": "Large Drone Repair Augmentor I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Drone Rigs"
            },
            {
                        "name": "Large Drone Scope Chip I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Drone Rigs"
            },
            {
                        "name": "Large Drone Speed Augmentor I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Drone Rigs"
            },
            {
                        "name": "Large Dynamic Fuel Valve I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Astronautics Rigs"
            },
            {
                        "name": "Large EM Armor Reinforcer I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Armor Rigs"
            },
            {
                        "name": "Large EM Shield Reinforcer I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Armor Rigs"
            },
            {
                        "name": "Large Egress Port Maximizer I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Engineer Rigs"
            },
            {
                        "name": "Large Emission Scope Sharpener I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Scanning Rigs"
            },
            {
                        "name": "Large Energy Ambit Extension I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Energy Weapon Rigs"
            },
            {
                        "name": "Large Energy Burst Aerator I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Energy Weapon Rigs"
            },
            {
                        "name": "Large Energy Collision Accelerator I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Energy Weapon Rigs"
            },
            {
                        "name": "Large Energy Discharge Elutriation I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Energy Weapon Rigs"
            },
            {
                        "name": "Large Energy Locus Coordinator I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Energy Weapon Rigs"
            },
            {
                        "name": "Large Energy Metastasis Adjuster I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Energy Weapon Rigs"
            },
            {
                        "name": "Large Engine Thermal Shielding I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Astronautics Rigs"
            },
            {
                        "name": "Large Explosive Armor Reinforcer I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Armor Rigs"
            },
            {
                        "name": "Large Explosive Shield Reinforcer I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Armor Rigs"
            },
            {
                        "name": "Large Gravity Capacitor Upgrade I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Shield Rigs"
            },
            {
                        "name": "Large Higgs Anchor I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Astronautics Rigs"
            },
            {
                        "name": "Large Hybrid Ambit Extension I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Hybrid Weapon Rigs"
            },
            {
                        "name": "Large Hybrid Burst Aerator I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Hybrid Weapon Rigs"
            },
            {
                        "name": "Large Hybrid Collision Accelerator I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Hybrid Weapon Rigs"
            },
            {
                        "name": "Large Hybrid Discharge Elutriation I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Hybrid Weapon Rigs"
            },
            {
                        "name": "Large Hybrid Locus Coordinator I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Hybrid Weapon Rigs"
            },
            {
                        "name": "Large Kinetic Armor Reinforcer I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Armor Rigs"
            },
            {
                        "name": "Large Kinetic Shield Reinforcer I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Shield Rigs"
            },
            {
                        "name": "Large Salvage Tackle I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Resource Processing Rigs"
            },
            {
                        "name": "Large Shield Booster I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Modules",
                        "subcategory": "Shield Modules"
            },
            {
                        "name": "Large Shield Extender I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Modules",
                        "subcategory": "Shield Modules"
            },
            {
                        "name": "Large Thermal Armor Reinforcer I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Armor Rigs"
            },
            {
                        "name": "Large Thermal Shield Reinforcer I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Shield Rigs"
            },
            {
                        "name": "Laser Focusing Crystals Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Components",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "Lead Charge S Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Hybrid Charges"
            },
            {
                        "name": "Light Armor Maintenance Bot I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Drones",
                        "subcategory": "Logistics Drones"
            },
            {
                        "name": "Light Hull Maintenance Bot I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Drones",
                        "subcategory": "Logistics Drones"
            },
            {
                        "name": "Light Missile Launcher I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Modules",
                        "subcategory": "Missiles"
            },
            {
                        "name": "Light Shield Maintenance Bot I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Drones",
                        "subcategory": "Logistics Drones"
            },
            {
                        "name": "Linear Shield Emitter Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Components",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "Magnate Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ships",
                        "subcategory": "Frigate"
            },
            {
                        "name": "Magpulse Thruster Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Components",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "Medium Armor Maintenance Bot I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Drones",
                        "subcategory": "Logistics Drones"
            },
            {
                        "name": "Medium Hull Maintenance Bot I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Drones",
                        "subcategory": "Logistics Drones"
            },
            {
                        "name": "Medium Processor Overclocking Unit I Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Engineer Rigs"
            },
            {
                        "name": "Medium Shield Booster I Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Modules",
                        "subcategory": "Shield Modules"
            },
            {
                        "name": "Medium Shield Extender I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Modules",
                        "subcategory": "Shield Modules"
            },
            {
                        "name": "Medium Shield Maintenance Bot I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Drones",
                        "subcategory": "Logistics Drones"
            },
            {
                        "name": "Mercoxit Asteroid Mining Crystal Type A I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Mining Crystal"
            },
            {
                        "name": "Missile Precision Disruption Script Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Scripts"
            },
            {
                        "name": "Missile Precision Script Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Scripts"
            },
            {
                        "name": "Missile Range Disruption Script Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Scripts"
            },
            {
                        "name": "Missile Range Script Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Scripts"
            },
            {
                        "name": "Mjolnir Cruise Missile Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Missiles"
            },
            {
                        "name": "Mjolnir Heavy Assault Missile Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Missiles"
            },
            {
                        "name": "Mjolnir Heavy Missile Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Missiles"
            },
            {
                        "name": "Mjolnir Light Missile Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Missiles"
            },
            {
                        "name": "Mjolnir Rocket Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Rockets"
            },
            {
                        "name": "Mjolnir Torpedo Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Torpedoes & Bombs"
            },
            {
                        "name": "Mobile Depot Blueprint",
                        "me": 8,
                        "te": 0,
                        "category": "Structures",
                        "subcategory": "Deployable Structures"
            },
            {
                        "name": "Mobile Tractor Unit Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Structures",
                        "subcategory": "Deployable Structures"
            },
            {
                        "name": "Myrmidon Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ships",
                        "subcategory": "Battlecruiser"
            },
            {
                        "name": "Nanite Repair Paste Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Nanite Repair Paste"
            },
            {
                        "name": "Nanoelectrical Microprocessor Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Components",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "Nova Cruise Missile Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Missiles"
            },
            {
                        "name": "Nova Heavy Assault Missile Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Missiles"
            },
            {
                        "name": "Nova Heavy Missile Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Missiles"
            },
            {
                        "name": "Nova Light Missile Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Missiles"
            },
            {
                        "name": "Nova Rocket Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Rockets"
            },
            {
                        "name": "Nova Torpedo Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Torpedoes & Bombs"
            },
            {
                        "name": "Nuclear L Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Projectile Charges"
            },
            {
                        "name": "Nuclear M Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Projectile Charges"
            },
            {
                        "name": "Nuclear S Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Projectile Charges"
            },
            {
                        "name": "Ogre I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Drones",
                        "subcategory": "Drones"
            },
            {
                        "name": "Ogre SD-900 Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Drones",
                        "subcategory": "Electronic Warfare Drones"
            },
            {
                        "name": "Omen Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ships",
                        "subcategory": "Cruiser"
            },
            {
                        "name": "Optimal Range Disruption Script Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Scripts"
            },
            {
                        "name": "Optimal Range Script Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Scripts"
            },
            {
                        "name": "Oxy-Organic Solvents Reaction Formula",
                        "me": 0,
                        "te": 0,
                        "category": "Reactions",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "Oxygen Fuel Block Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Components",
                        "subcategory": "Fuel Blocks"
            },
            {
                        "name": "Phased Plasma L Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Projectile Charges"
            },
            {
                        "name": "Phased Plasma M Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Projectile Charges"
            },
            {
                        "name": "Plutonium Charge L Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Hybrid Charges"
            },
            {
                        "name": "Plutonium Charge XL Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Hybrid Charges"
            },
            {
                        "name": "Praetor EV-900 Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Drones",
                        "subcategory": "Combat Utility Drones"
            },
            {
                        "name": "Praetor TD-900 Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Drones",
                        "subcategory": "Electronic Warfare Drones"
            },
            {
                        "name": "Probe Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ships",
                        "subcategory": "Frigate"
            },
            {
                        "name": "Prometium Reaction Formula",
                        "me": 0,
                        "te": 0,
                        "category": "Reactions",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "Proton L Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Projectile Charges"
            },
            {
                        "name": "Proton M Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Projectile Charges"
            },
            {
                        "name": "Proton S Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Projectile Charges"
            },
            {
                        "name": "R.A.M.- Ammunition Tech Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Components",
                        "subcategory": "Tool"
            },
            {
                        "name": "R.A.M.- Armor/Hull Tech Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Components",
                        "subcategory": "Tool"
            },
            {
                        "name": "R.A.M.- Electronics Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Components",
                        "subcategory": "Tool"
            },
            {
                        "name": "R.A.M.- Energy Tech Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Components",
                        "subcategory": "Tool"
            },
            {
                        "name": "R.A.M.- Robotics Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Components",
                        "subcategory": "Tool"
            },
            {
                        "name": "R.A.M.- Shield Tech Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Components",
                        "subcategory": "Tool"
            },
            {
                        "name": "R.A.M.- Starship Tech Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Components",
                        "subcategory": "Tool"
            },
            {
                        "name": "R.A.M.- Weapon Tech Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Components",
                        "subcategory": "Tool"
            },
            {
                        "name": "Radar Sensor Cluster Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Components",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "Rapid Deployment Charge Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Command Burst Charge"
            },
            {
                        "name": "Rapid Repair Charge Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Command Burst Charge"
            },
            {
                        "name": "Reinforced Carbon Fiber Reaction Formula",
                        "me": 0,
                        "te": 0,
                        "category": "Reactions",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "Relic Analyzer I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Modules",
                        "subcategory": "Scanning Modules"
            },
            {
                        "name": "Scalar Capacitor Unit Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Components",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "Scan Resolution Dampening Script Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Scripts"
            },
            {
                        "name": "Scan Resolution Script Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Scripts"
            },
            {
                        "name": "Scourge Cruise Missile Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Missiles"
            },
            {
                        "name": "Scourge Heavy Assault Missile Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Missiles"
            },
            {
                        "name": "Scourge Heavy Missile Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Missiles"
            },
            {
                        "name": "Scourge Light Missile Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Missiles"
            },
            {
                        "name": "Scourge Rocket Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Rockets"
            },
            {
                        "name": "Scourge Torpedo Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Torpedoes & Bombs"
            },
            {
                        "name": "Scythe Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ships",
                        "subcategory": "Cruiser"
            },
            {
                        "name": "Sensor Optimization Charge Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Command Burst Charge"
            },
            {
                        "name": "Shield Extension Charge Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Command Burst Charge"
            },
            {
                        "name": "Shield Harmonizing Charge Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Command Burst Charge"
            },
            {
                        "name": "Shield Power Relay I Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Modules",
                        "subcategory": "Shield Modules"
            },
            {
                        "name": "Shield Recharger I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Modules",
                        "subcategory": "Shield Modules"
            },
            {
                        "name": "Sigil Blueprint",
                        "me": 5,
                        "te": 0,
                        "category": "Ships",
                        "subcategory": "Hauler"
            },
            {
                        "name": "Simple Asteroid Mining Crystal Type A I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Mining Crystal"
            },
            {
                        "name": "Small Dynamic Fuel Valve I Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Astronautics Rigs"
            },
            {
                        "name": "Small EM Shield Reinforcer I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Rigs",
                        "subcategory": "Shield Rigs"
            },
            {
                        "name": "Small Gravity Capacitor Upgrade I Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Scanning Rigs"
            },
            {
                        "name": "Small Hydraulic Bay Thrusters I Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Missile Launcher Rigs"
            },
            {
                        "name": "Small Kinetic Shield Reinforcer I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Rigs",
                        "subcategory": "Shield Rigs"
            },
            {
                        "name": "Small Low Friction Nozzle Joints I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Rigs",
                        "subcategory": "Astronautics Rigs"
            },
            {
                        "name": "Small Warhead Calefaction Catalyst I Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Missile Launcher Rigs"
            },
            {
                        "name": "Small Warhead Flare Catalyst I Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Missile Launcher Rigs"
            },
            {
                        "name": "Small Warhead Rigor Catalyst I Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Rigs",
                        "subcategory": "Missile Launcher Rigs"
            },
            {
                        "name": "Standard M Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Frequency Crystals"
            },
            {
                        "name": "Standup Cruise Missile Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Missiles"
            },
            {
                        "name": "Standup Heavy Guided Bomb Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Bombs"
            },
            {
                        "name": "Standup Heavy Missile Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Missiles"
            },
            {
                        "name": "Standup Light Guided Bomb Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Bombs"
            },
            {
                        "name": "Standup Light Missile Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Missiles"
            },
            {
                        "name": "Station Container Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Structures",
                        "subcategory": "Deployable Structures"
            },
            {
                        "name": "Station Warehouse Container Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Structures",
                        "subcategory": "Deployable Structures"
            },
            {
                        "name": "Synth Crash Booster Reaction Formula",
                        "me": 0,
                        "te": 0,
                        "category": "Reactions",
                        "subcategory": "Reactions"
            },
            {
                        "name": "Synth Exile Booster Reaction Formula",
                        "me": 0,
                        "te": 0,
                        "category": "Reactions",
                        "subcategory": "Reactions"
            },
            {
                        "name": "Talwar Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Ships",
                        "subcategory": "Destroyer"
            },
            {
                        "name": "Targeting Range Dampening Script Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Scripts"
            },
            {
                        "name": "Targeting Range Script Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Scripts"
            },
            {
                        "name": "Tesseract Capacitor Unit Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Components",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "Thermosetting Polymer Reaction Formula",
                        "me": 0,
                        "te": 0,
                        "category": "Reactions",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "Thorax Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ships",
                        "subcategory": "Cruiser"
            },
            {
                        "name": "Thorium Charge L Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Hybrid Charges"
            },
            {
                        "name": "Thorium Charge M Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Hybrid Charges"
            },
            {
                        "name": "Thorium Charge XL Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Hybrid Charges"
            },
            {
                        "name": "Thrasher Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Ships",
                        "subcategory": "Destroyer"
            },
            {
                        "name": "Titanium Diborite Armor Plate Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Components",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "Titanium Sabot L Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Projectile Charges"
            },
            {
                        "name": "Titanium Sabot M Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Projectile Charges"
            },
            {
                        "name": "Titanium Sabot S Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Projectile Charges"
            },
            {
                        "name": "Tracking Speed Disruption Script Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Scripts"
            },
            {
                        "name": "Tracking Speed Script Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Ammunition",
                        "subcategory": "Scripts"
            },
            {
                        "name": "Tristan Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ships",
                        "subcategory": "Frigate"
            },
            {
                        "name": "Tungsten Carbide Armor Plate Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Components",
                        "subcategory": "Ship Components"
            },
            {
                        "name": "Valkyrie I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Drones",
                        "subcategory": "Drones"
            },
            {
                        "name": "Valkyrie SW-600 Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Drones",
                        "subcategory": "Electronic Warfare Drones"
            },
            {
                        "name": "Valkyrie TP-600 Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Drones",
                        "subcategory": "Electronic Warfare Drones"
            },
            {
                        "name": "Variegated Asteroid Mining Crystal Type A I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Mining Crystal"
            },
            {
                        "name": "Venture Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ships",
                        "subcategory": "Frigate"
            },
            {
                        "name": "Vespa EC-600 Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Drones",
                        "subcategory": "Electronic Warfare Drones"
            },
            {
                        "name": "Vespa I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Drones",
                        "subcategory": "Drones"
            },
            {
                        "name": "Vexor Blueprint",
                        "me": 10,
                        "te": 14,
                        "category": "Ships",
                        "subcategory": "Cruiser"
            },
            {
                        "name": "Warp Disrupt Probe Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Ammunition",
                        "subcategory": "Scan Probe"
            },
            {
                        "name": "Warrior I Blueprint",
                        "me": 10,
                        "te": 20,
                        "category": "Drones",
                        "subcategory": "Drones"
            },
            {
                        "name": "Warrior SW-300 Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Drones",
                        "subcategory": "Electronic Warfare Drones"
            },
            {
                        "name": "Warrior TP-300 Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Drones",
                        "subcategory": "Electronic Warfare Drones"
            },
            {
                        "name": "Wasp EC-900 Blueprint",
                        "me": 10,
                        "te": 0,
                        "category": "Drones",
                        "subcategory": "Electronic Warfare Drones"
            },
            {
                        "name": "X-Large Shield Booster I Blueprint",
                        "me": 0,
                        "te": 0,
                        "category": "Modules",
                        "subcategory": "Shield Modules"
            }
];

        // ============================================
        // DATA CONFIGURATION
        // ============================================

        const MINERALS = [
            'Tritanium', 'Pyerite', 'Isogen', 'Mexallon',
            'Nocxium', 'Zydrine', 'Megacyte', 'Morphite'
        ];

        const ICE_PRODUCTS = [
            'Heavy Water', 'Liquid Ozone', 'Strontium Clathrates',
            'Oxygen Isotopes', 'Hydrogen Isotopes', 'Helium Isotopes', 'Nitrogen Isotopes'
        ];

        const MOON_MATERIALS = {
            'R4 - Ubiquitous': ['Atmospheric Gases', 'Evaporite Deposits', 'Hydrocarbons', 'Silicates'],
            'R8 - Common': ['Cobalt', 'Scandium', 'Tungsten', 'Titanium'],
            'R16 - Uncommon': ['Chromium', 'Cadmium', 'Platinum', 'Vanadium'],
            'R32 - Rare': ['Technetium', 'Mercury', 'Caesium', 'Hafnium'],
            'R64 - Exceptional': ['Promethium', 'Neodymium', 'Dysprosium', 'Thulium']
        };

        let allBlueprints = [];
        let filteredBlueprints = [];

        // ============================================
        // VIEW TOGGLE FUNCTIONS
        // ============================================

        function expandInventory() {
            document.getElementById('container').classList.add('expanded');
        }

        function collapseInventory() {
            document.getElementById('container').classList.remove('expanded');
        }

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                collapseInventory();
            }
        });

        // ============================================
        // TAB SWITCHING FUNCTIONS
        // ============================================

        function showMainTab(tabName) {
            // Hide all main tabs
            document.querySelectorAll('#market-tab, #blueprints-tab, #buyback-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active class from all main tab buttons
            document.querySelectorAll('.main-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');

            // Mark button as active
            event.target.classList.add('active');
        }

        function showSubTab(subTabName) {
            // Hide all sub-content
            document.querySelectorAll('#minerals-content, #ice-content, #moon-content').forEach(content => {
                content.classList.remove('active');
            });

            // Remove active class from all sub-tab buttons
            document.querySelectorAll('.sub-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected sub-content
            document.getElementById(subTabName + '-content').classList.add('active');

            // Mark button as active
            event.target.classList.add('active');
        }

        // ============================================
        // DATA LOADING AND RENDERING
        // ============================================

        async function loadInventoryData() {
            const inventory = EMBEDDED_DATA.inventory;
            renderMinerals(inventory);
            renderIceProducts(inventory);
            renderMoonMaterials(inventory);
        }

        // ============================================
        // RESEARCH JOBS FUNCTIONS
        // ============================================

        // RESEARCH_JOBS is loaded from external script (research_jobs.js)
        // No need to declare it here - just reference the global variable
        let researchTimerInterval = null;

        function toggleResearchSection() {
            const section = document.getElementById('researchSection');
            section.classList.toggle('collapsed');
        }

        function loadResearchJobs() {
            // RESEARCH_JOBS is loaded from research_jobs.js script tag
            if (typeof RESEARCH_JOBS !== 'undefined' && RESEARCH_JOBS && RESEARCH_JOBS.length > 0) {
                console.log(` Loaded ${RESEARCH_JOBS.length} research jobs`);
                renderResearchJobs();
            } else {
                console.log('No research jobs data found');
                hideResearchSection();
            }
        }

        function renderResearchJobs() {
            const section = document.getElementById('researchSection');
            const grid = document.getElementById('researchGrid');

            if (!RESEARCH_JOBS || RESEARCH_JOBS.length === 0) {
                hideResearchSection();
                return;
            }

            // Show the section
            section.style.display = 'block';

            // Clear existing content
            grid.innerHTML = '';

            // Render each job
            RESEARCH_JOBS.forEach(job => {
                const jobCard = document.createElement('div');
                jobCard.className = 'research-job';
                jobCard.dataset.endDate = job.end_date;

                jobCard.innerHTML = `
                    <div class="research-job-name">${job.name}</div>
                    <div class="research-job-detail">
                        <span class="label">Research Type:</span>
                        <span class="value">${job.research_type} (${job.current_level}  ${job.target_level})</span>
                    </div>
                    <div class="research-countdown" data-end="${job.end_date}">
                        Calculating...
                    </div>
                `;

                grid.appendChild(jobCard);
            });

            // Start countdown timers
            startResearchTimers();
        }

        function hideResearchSection() {
            const section = document.getElementById('researchSection');
            section.style.display = 'none';

            if (researchTimerInterval) {
                clearInterval(researchTimerInterval);
                researchTimerInterval = null;
            }
        }

        function startResearchTimers() {
            // Clear existing interval if any
            if (researchTimerInterval) {
                clearInterval(researchTimerInterval);
            }

            // Update timers immediately
            updateResearchTimers();

            // Update every second
            researchTimerInterval = setInterval(updateResearchTimers, 1000);
        }

        function updateResearchTimers() {
            const countdowns = document.querySelectorAll('.research-countdown');
            const now = new Date();

            countdowns.forEach(countdown => {
                const endDate = new Date(countdown.dataset.end);
                const diff = endDate - now;

                if (diff <= 0) {
                    countdown.textContent = 'Complete!';
                    countdown.style.color = '#00ff88';
                } else {
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                    let timeStr = '';
                    if (days > 0) {
                        timeStr = `${days}d ${hours}h ${minutes}m`;
                    } else if (hours > 0) {
                        timeStr = `${hours}h ${minutes}m ${seconds}s`;
                    } else if (minutes > 0) {
                        timeStr = `${minutes}m ${seconds}s`;
                    } else {
                        timeStr = `${seconds}s`;
                    }

                    countdown.textContent = timeStr;
                }
            });
        }

        let bpcPricingData = [];

        async function loadBPCPricingData() {
            // BPC pricing data is loaded via script tag in head
            if (typeof BPC_PRICING_DATA !== 'undefined') {
                bpcPricingData = BPC_PRICING_DATA;
                console.log(` Loaded ${bpcPricingData.length} blueprint pricing entries`);

                if (typeof calculateBPCPrice === 'function') {
                    console.log(` Price calculator function loaded`);
                }
            } else {
                console.error(' BPC_PRICING_DATA not found - bpc_pricing_data.js may not be loaded');
                bpcPricingData = [];
            }
        }

        async function loadBlueprintData() {
            // BLUEPRINT_DATA is embedded in the HTML (updated by update_html_data.py)
            if (typeof BLUEPRINT_DATA !== 'undefined' && BLUEPRINT_DATA && BLUEPRINT_DATA.length > 0) {
                allBlueprints = BLUEPRINT_DATA;
            } else {
                console.warn('BLUEPRINT_DATA not found or empty');
                allBlueprints = [];
            }

            // Load pricing data
            await loadBPCPricingData();

            if (allBlueprints.length > 0) {
                populateFilters();
                filteredBlueprints = [...allBlueprints];
                renderBlueprints();
            }
        }

        async function loadLastUpdated() {
            // Market tab shows inventory timestamp
            document.getElementById('lastUpdated').textContent = `Last updated: ${EMBEDDED_DATA.inventoryLastUpdated}`;
            // Blueprint tab shows blueprint timestamp
            document.getElementById('lastUpdated2').textContent = `Last updated: ${EMBEDDED_DATA.blueprintsLastUpdated}`;
        }

        function renderMinerals(inventory) {
            const grid = document.getElementById('minerals-grid');
            grid.innerHTML = '';

            MINERALS.forEach(mineral => {
                const quantity = inventory[mineral] || 0;
                // Tritanium has special pricing
                const priceText = mineral === 'Tritanium' ? '97% JBV (3% below alliance)' : '98% JBV (2% below alliance)';
                const item = createItemCard(mineral, quantity, priceText);
                grid.appendChild(item);
            });
        }

        function renderIceProducts(inventory) {
            const grid = document.getElementById('ice-grid');
            grid.innerHTML = '';

            ICE_PRODUCTS.forEach(product => {
                const quantity = inventory[product] || 0;
                const priceText = product.includes('Isotopes') ? '97% JBV (5% below alliance)' : '98% JBV (4% below alliance)';
                const item = createItemCard(product, quantity, priceText);
                grid.appendChild(item);
            });
        }

        function renderMoonMaterials(inventory) {
            const container = document.getElementById('moon-materials');
            container.innerHTML = '';

            Object.entries(MOON_MATERIALS).forEach(([group, materials]) => {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'item-grid moon-material-group';

                materials.forEach(material => {
                    const quantity = inventory[material] || 0;
                    const item = createItemCard(material, quantity, '98% JBV (4% below alliance)');
                    groupDiv.appendChild(item);
                });

                container.appendChild(groupDiv);
            });
        }

        function createItemCard(name, quantity, price) {
            const item = document.createElement('div');
            item.className = 'item';

            const formattedQty = quantity.toLocaleString();
            const qtyClass = quantity === 0 ? 'detail-value out-of-stock' : 'detail-value';

            item.innerHTML = `
                <div class="item-name">${name}</div>
                <div class="item-details">
                    <div class="detail-row">
                        <span class="detail-label">Stock:</span>
                        <span class="${qtyClass}">${formattedQty} units</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Price:</span>
                        <span class="detail-value">${price}</span>
                    </div>
                </div>
            `;

            return item;
        }

        // ============================================
        // BLUEPRINT TABLE FUNCTIONS
        // ============================================

        function populateFilters() {
            const categories = [...new Set(allBlueprints.map(bp => bp.category))].sort();

            const categoryFilter = document.getElementById('categoryFilter');
            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                categoryFilter.appendChild(option);
            });

            // Initially populate subcategory with all options
            updateSubcategoryFilter();
            updateResearchFilter();

            document.getElementById('searchFilter').addEventListener('input', applyFilters);
            categoryFilter.addEventListener('change', function() {
                updateSubcategoryFilter();
                updateResearchFilter();
                applyFilters();
            });
            document.getElementById('subcategoryFilter').addEventListener('change', function() {
                updateResearchFilter();
                applyFilters();
            });
            document.getElementById('researchFilter').addEventListener('change', applyFilters);
        }

        function updateSubcategoryFilter() {
            const category = document.getElementById('categoryFilter').value;
            const subcategoryFilter = document.getElementById('subcategoryFilter');

            // Get current selection
            const currentSelection = subcategoryFilter.value;

            // Clear existing options except the first "All" option
            subcategoryFilter.innerHTML = '<option value="">All Sub-Categories</option>';

            // Get relevant subcategories based on selected category
            let relevantBlueprints = allBlueprints;
            if (category) {
                relevantBlueprints = allBlueprints.filter(bp => bp.category === category);
            }

            const subcategories = [...new Set(relevantBlueprints.map(bp => bp.subcategory))].sort();

            subcategories.forEach(subcat => {
                const option = document.createElement('option');
                option.value = subcat;
                option.textContent = subcat;
                subcategoryFilter.appendChild(option);
            });

            // Restore selection if still valid
            if (currentSelection && subcategories.includes(currentSelection)) {
                subcategoryFilter.value = currentSelection;
            }
        }

        function updateResearchFilter() {
            const category = document.getElementById('categoryFilter').value;
            const subcategory = document.getElementById('subcategoryFilter').value;
            const researchFilter = document.getElementById('researchFilter');

            // Get current selection
            const currentSelection = researchFilter.value;

            // Get relevant blueprints based on current filters
            let relevantBlueprints = allBlueprints;
            if (category) {
                relevantBlueprints = relevantBlueprints.filter(bp => bp.category === category);
            }
            if (subcategory) {
                relevantBlueprints = relevantBlueprints.filter(bp => bp.subcategory === subcategory);
            }

            // Check which research statuses exist in filtered blueprints
            const hasPerfect = relevantBlueprints.some(bp => bp.me === 10 && bp.te === 20);
            const hasPartial = relevantBlueprints.some(bp => (bp.me > 0 || bp.te > 0) && !(bp.me === 10 && bp.te === 20));
            const hasNone = relevantBlueprints.some(bp => bp.me === 0 && bp.te === 0);

            // Clear and rebuild options
            researchFilter.innerHTML = '<option value="">All</option>';

            if (hasPerfect) {
                const option = document.createElement('option');
                option.value = 'perfect';
                option.textContent = 'Perfect (ME10/TE20)';
                researchFilter.appendChild(option);
            }

            if (hasPartial) {
                const option = document.createElement('option');
                option.value = 'partial';
                option.textContent = 'Partial';
                researchFilter.appendChild(option);
            }

            if (hasNone) {
                const option = document.createElement('option');
                option.value = 'none';
                option.textContent = 'No Research';
                researchFilter.appendChild(option);
            }

            // Restore selection if still valid
            const validValues = Array.from(researchFilter.options).map(opt => opt.value);
            if (currentSelection && validValues.includes(currentSelection)) {
                researchFilter.value = currentSelection;
            }
        }

        function applyFilters() {
            const searchTerm = document.getElementById('searchFilter').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;
            const subcategory = document.getElementById('subcategoryFilter').value;
            const research = document.getElementById('researchFilter').value;

            filteredBlueprints = allBlueprints.filter(bp => {
                if (searchTerm && !bp.name.toLowerCase().includes(searchTerm)) {
                    return false;
                }

                if (category && bp.category !== category) {
                    return false;
                }

                if (subcategory && bp.subcategory !== subcategory) {
                    return false;
                }

                if (research) {
                    const isPerfect = bp.me === 10 && bp.te === 20;
                    const isPartial = (bp.me > 0 || bp.te > 0) && !isPerfect;
                    const isNone = bp.me === 0 && bp.te === 0;

                    if (research === 'perfect' && !isPerfect) return false;
                    if (research === 'partial' && !isPartial) return false;
                    if (research === 'none' && !isNone) return false;
                }

                return true;
            });

            renderBlueprints();
        }

        function renderBlueprints() {
            const tbody = document.getElementById('blueprintTableBody');
            tbody.innerHTML = '';

            filteredBlueprints.forEach(bp => {
                const row = document.createElement('tr');

                // Find pricing data for this blueprint
                const pricing = bpcPricingData.find(p => p.blueprintName === bp.name);

                let qualityCell = '<td style="color: #888;">-</td>';
                let priceCell = '<td style="color: #888;">-</td>';
                let calculatorCell = '<td></td>';

                if (pricing) {
                    // Quality percentage with color coding
                    let qualityColor = '#00d9ff';  // Cyan for perfect
                    if (pricing.qualityPercent < 85) qualityColor = '#ffaa00';  // Orange
                    if (pricing.qualityPercent < 60) qualityColor = '#ff6b6b';  // Red

                    qualityCell = `<td style="color: ${qualityColor}; font-weight: bold;">${pricing.qualityPercent}%</td>`;

                    // Format price
                    const priceFormatted = pricing.price10Runs >= 1_000_000
                        ? `${(pricing.price10Runs / 1_000_000).toFixed(2)}M`
                        : `${(pricing.price10Runs / 1_000).toFixed(1)}k`;

                    priceCell = `<td style="color: #00ff88;">${priceFormatted} ISK</td>`;

                    // Calculator button
                    calculatorCell = `<td><button class="calc-btn" onclick="openCalculator('${bp.name}', ${pricing.blueprintTypeId})">Calculate</button></td>`;
                }

                row.innerHTML = `
                    <td>${bp.name}</td>
                    <td>${bp.category}</td>
                    <td>${bp.subcategory}</td>
                    <td>${bp.me}</td>
                    <td>${bp.te}</td>
                    ${qualityCell}
                    ${priceCell}
                    ${calculatorCell}
                `;

                tbody.appendChild(row);
            });
        }

        let sortDirection = {};

        function sortTable(columnIndex) {
            const direction = sortDirection[columnIndex] === 'asc' ? 'desc' : 'asc';
            sortDirection[columnIndex] = direction;

            filteredBlueprints.sort((a, b) => {
                let aVal, bVal;

                switch(columnIndex) {
                    case 0: // Name
                        aVal = a.name;
                        bVal = b.name;
                        break;
                    case 1: // Category
                        aVal = a.category;
                        bVal = b.category;
                        break;
                    case 2: // Sub-Category
                        aVal = a.subcategory;
                        bVal = b.subcategory;
                        break;
                    case 3: // ME
                        aVal = a.me;
                        bVal = b.me;
                        break;
                    case 4: // TE
                        aVal = a.te;
                        bVal = b.te;
                        break;
                    case 5: // Quality
                        const pricingA = bpcPricingData.find(p => p.blueprintName === a.name);
                        const pricingB = bpcPricingData.find(p => p.blueprintName === b.name);
                        aVal = pricingA ? pricingA.qualityPercent : 0;
                        bVal = pricingB ? pricingB.qualityPercent : 0;
                        break;
                    case 6: // Price
                        const priceA = bpcPricingData.find(p => p.blueprintName === a.name);
                        const priceB = bpcPricingData.find(p => p.blueprintName === b.name);
                        aVal = priceA ? priceA.price10Runs : 0;
                        bVal = priceB ? priceB.price10Runs : 0;
                        break;
                }

                if (typeof aVal === 'string') {
                    return direction === 'asc'
                        ? aVal.localeCompare(bVal)
                        : bVal.localeCompare(aVal);
                } else {
                    return direction === 'asc'
                        ? aVal - bVal
                        : bVal - aVal;
                }
            });

            renderBlueprints();
        }

        // ============================================
        // BPC CALCULATOR FUNCTIONS
        // ============================================

        let currentBlueprintTypeId = null;

        function openCalculator(blueprintName, blueprintTypeId) {
            currentBlueprintTypeId = blueprintTypeId;
            const pricing = bpcPricingData.find(p => p.blueprintTypeId === blueprintTypeId);

            if (!pricing) {
                alert('Pricing data not available for this blueprint');
                return;
            }

            // Set modal title
            document.getElementById('calcModalTitle').textContent = blueprintName.replace(' Blueprint', '');

            // Set blueprint info
            document.getElementById('calcQuality').textContent = `${pricing.qualityPercent}% (ME ${pricing.me} / TE ${pricing.te})`;
            document.getElementById('calcJitaPrice').textContent = formatISK(pricing.jitaSellPrice);

            // Reset inputs and unlock for BPOs
            document.getElementById('calcRuns').value = 10;
            document.getElementById('calcRuns').disabled = false;  // Unlock runs for BPOs
            document.getElementById('calcCopies').value = 1;
            document.getElementById('calcCopies').disabled = false;

            // Calculate initial price
            calculatePrice();

            // Show modal
            document.getElementById('bpcCalculatorModal').style.display = 'block';
        }

        function closeCalculator() {
            document.getElementById('bpcCalculatorModal').style.display = 'none';
        }

        // =================================================================
        // BPC TAB FUNCTIONS
        // =================================================================

        let allBPCs = [];
        let filteredBPCs = [];
        let bpcSortDirection = {};

        // Tab switching function
        function showBlueprintTab(tabType) {
            // Hide all blueprint sub-tabs
            document.querySelectorAll('.blueprint-tab-content').forEach(tab => {
                tab.classList.remove('active');
                tab.style.display = 'none';
            });

            // Remove active class from all buttons
            document.querySelectorAll('.blueprint-subtab').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            const tabContent = document.getElementById(tabType + '-tab-content');
            if (tabContent) {
                tabContent.classList.add('active');
                tabContent.style.display = 'block';
            }

            // Mark button as active
            event.target.classList.add('active');
        }

        // Load BPC data from bpc_data.js
        async function loadBPCData() {
            try {
                // Ensure pricing data is loaded first
                if (bpcPricingData.length === 0) {
                    await loadBPCPricingData();
                }

                // BPC_DATA is loaded from bpc_data.js script tag
                if (typeof BPC_DATA !== 'undefined' && BPC_DATA) {
                    allBPCs = BPC_DATA;
                    filteredBPCs = [...allBPCs];

                    // Populate filter dropdowns
                    populateBPCFilters();
                    updateSubcategoryFilterBPC();

                    // Render table
                    renderBPCs();
                } else {
                    console.warn('BPC_DATA not found - bpc_data.js may not be loaded');
                }
            } catch (error) {
                console.error('Error loading BPC data:', error);
            }
        }

        // Populate BPC filter dropdowns
        function populateBPCFilters() {
            const categories = [...new Set(allBPCs.map(bpc => bpc.category))].sort();
            const subcategories = [...new Set(allBPCs.map(bpc => bpc.subcategory))].sort();

            const categorySelect = document.getElementById('categoryFilterBPC');
            const subcategorySelect = document.getElementById('subcategoryFilterBPC');

            // Clear existing options (except "All")
            categorySelect.innerHTML = '<option value="">All Categories</option>';
            subcategorySelect.innerHTML = '<option value="">All Sub-Categories</option>';

            // Add category options
            categories.forEach(cat => {
                if (cat) {
                    const option = document.createElement('option');
                    option.value = cat;
                    option.textContent = cat;
                    categorySelect.appendChild(option);
                }
            });

            // Add subcategory options
            subcategories.forEach(subcat => {
                if (subcat) {
                    const option = document.createElement('option');
                    option.value = subcat;
                    option.textContent = subcat;
                    subcategorySelect.appendChild(option);
                }
            });
        }

        // Update BPC subcategory filter based on selected category
        function updateSubcategoryFilterBPC() {
            const category = document.getElementById('categoryFilterBPC').value;
            const subcategoryFilter = document.getElementById('subcategoryFilterBPC');

            // Get current selection
            const currentSelection = subcategoryFilter.value;

            // Clear existing options except the first "All" option
            subcategoryFilter.innerHTML = '<option value="">All Sub-Categories</option>';

            // Get relevant subcategories based on selected category
            let relevantBPCs = allBPCs;
            if (category) {
                relevantBPCs = allBPCs.filter(bpc => bpc.category === category);
            }

            const subcategories = [...new Set(relevantBPCs.map(bpc => bpc.subcategory))].sort();

            subcategories.forEach(subcat => {
                if (subcat) {
                    const option = document.createElement('option');
                    option.value = subcat;
                    option.textContent = subcat;
                    subcategoryFilter.appendChild(option);
                }
            });

            // Restore selection if still valid
            if (currentSelection && subcategories.includes(currentSelection)) {
                subcategoryFilter.value = currentSelection;
            }
        }

        // Apply BPC filters
        function applyBPCFilters() {
            const searchTerm = document.getElementById('searchFilterBPC').value.toLowerCase();
            const category = document.getElementById('categoryFilterBPC').value;
            const subcategory = document.getElementById('subcategoryFilterBPC').value;
            const runsFilter = document.getElementById('runsFilterBPC').value;

            filteredBPCs = allBPCs.filter(bpc => {
                // Search filter
                if (searchTerm && !bpc.name.toLowerCase().includes(searchTerm)) {
                    return false;
                }

                // Category filter
                if (category && bpc.category !== category) {
                    return false;
                }

                // Subcategory filter
                if (subcategory && bpc.subcategory !== subcategory) {
                    return false;
                }

                // Runs filter
                if (runsFilter) {
                    if (runsFilter === '1-10' && (bpc.runs < 1 || bpc.runs > 10)) return false;
                    if (runsFilter === '11-50' && (bpc.runs < 11 || bpc.runs > 50)) return false;
                    if (runsFilter === '51-100' && (bpc.runs < 51 || bpc.runs > 100)) return false;
                    if (runsFilter === '101+' && bpc.runs < 101) return false;
                }

                return true;
            });

            renderBPCs();
        }

        // Render BPC table
        function renderBPCs() {
            const tbody = document.getElementById('bpcTableBody');
            tbody.innerHTML = '';

            filteredBPCs.forEach(bpc => {
                const row = document.createElement('tr');

                // Find pricing data (match by typeId, ME, and TE)
                const pricing = bpcPricingData.find(p =>
                    p.blueprintTypeId === bpc.typeId &&
                    p.me === bpc.me &&
                    p.te === bpc.te
                );

                let qualityCell = '<td style="color: #888;">-</td>';
                let priceCell = '<td style="color: #888;">-</td>';
                let calculatorCell = '<td></td>';

                if (pricing) {
                    // Quality with color coding
                    let qualityColor = '#00d9ff';  // Cyan for perfect
                    if (pricing.qualityPercent < 85) qualityColor = '#ffaa00';  // Orange
                    if (pricing.qualityPercent < 60) qualityColor = '#ff6b6b';  // Red

                    qualityCell = `<td style="color: ${qualityColor}; font-weight: bold;">${pricing.qualityPercent}%</td>`;

                    // Calculate price for this specific runs (1 copy)
                    if (typeof calculateBPCPrice === 'function') {
                        const bpcPrice = calculateBPCPrice(bpc.typeId, bpc.runs, 1);
                        if (bpcPrice) {
                            const priceFormatted = bpcPrice.totalPrice >= 1_000_000
                                ? `${(bpcPrice.totalPrice / 1_000_000).toFixed(2)}M`
                                : `${(bpcPrice.totalPrice / 1_000).toFixed(1)}k`;

                            priceCell = `<td style="color: #00ff88;">${priceFormatted} ISK</td>`;
                        }
                    }

                    // Calculator button (pre-fill with BPC runs and quantity)
                    calculatorCell = `<td><button class="calc-btn" onclick="openCalculatorForBPC('${bpc.name.replace(/'/g, "\\'")}', ${bpc.typeId}, ${bpc.runs}, ${bpc.quantity}, ${bpc.me}, ${bpc.te})">Calculate</button></td>`;
                }

                row.innerHTML = `
                    <td>${bpc.name}</td>
                    <td>${bpc.category}</td>
                    <td>${bpc.subcategory}</td>
                    <td>${bpc.me}</td>
                    <td>${bpc.te}</td>
                    <td style="color: #00d9ff;">${bpc.runs}</td>
                    <td style="color: #00ff88; font-weight: bold;">${bpc.quantity}x</td>
                    ${qualityCell}
                    ${priceCell}
                    ${calculatorCell}
                `;

                tbody.appendChild(row);
            });
        }

        // Sort BPC table
        function sortBPCTable(columnIndex) {
            const direction = bpcSortDirection[columnIndex] === 'asc' ? 'desc' : 'asc';
            bpcSortDirection[columnIndex] = direction;

            filteredBPCs.sort((a, b) => {
                let aVal, bVal;

                switch(columnIndex) {
                    case 0: // Name
                        aVal = a.name;
                        bVal = b.name;
                        break;
                    case 1: // Category
                        aVal = a.category;
                        bVal = b.category;
                        break;
                    case 2: // Sub-Category
                        aVal = a.subcategory;
                        bVal = b.subcategory;
                        break;
                    case 3: // ME
                        aVal = a.me;
                        bVal = b.me;
                        break;
                    case 4: // TE
                        aVal = a.te;
                        bVal = b.te;
                        break;
                    case 5: // Runs
                        aVal = a.runs;
                        bVal = b.runs;
                        break;
                    case 6: // Quantity
                        aVal = a.quantity;
                        bVal = b.quantity;
                        break;
                    case 7: // Quality
                        const pricingA = bpcPricingData.find(p => p.blueprintTypeId === a.typeId);
                        const pricingB = bpcPricingData.find(p => p.blueprintTypeId === b.typeId);
                        aVal = pricingA ? pricingA.qualityPercent : 0;
                        bVal = pricingB ? pricingB.qualityPercent : 0;
                        break;
                    case 8: // Price
                        const priceA = calculateBPCPrice(a.typeId, a.runs, 1);
                        const priceB = calculateBPCPrice(b.typeId, b.runs, 1);
                        aVal = priceA ? priceA.final_price : 0;
                        bVal = priceB ? priceB.final_price : 0;
                        break;
                    default:
                        return 0;
                }

                if (typeof aVal === 'string') {
                    return direction === 'asc'
                        ? aVal.localeCompare(bVal)
                        : bVal.localeCompare(aVal);
                } else {
                    return direction === 'asc'
                        ? aVal - bVal
                        : bVal - aVal;
                }
            });

            renderBPCs();
        }

        // Open calculator for BPCs
        function openCalculatorForBPC(blueprintName, blueprintTypeId, bpcRuns, bpcQuantity, me, te) {
            currentBlueprintTypeId = blueprintTypeId;
            const pricing = bpcPricingData.find(p =>
                p.blueprintTypeId === blueprintTypeId &&
                p.me === me &&
                p.te === te
            );

            if (!pricing) {
                alert('Pricing data not available for this blueprint');
                return;
            }

            // Set modal title
            document.getElementById('calcModalTitle').textContent = blueprintName.replace(' Blueprint', '');

            // Set blueprint info
            document.getElementById('calcQuality').textContent = `${pricing.qualityPercent}% (ME ${pricing.me} / TE ${pricing.te})`;
            document.getElementById('calcJitaPrice').textContent = formatISK(pricing.jitaSellPrice);

            // Pre-fill with BPC runs and quantity (both locked since it's a BPC)
            document.getElementById('calcRuns').value = bpcRuns;
            document.getElementById('calcRuns').disabled = true;  // Lock runs for BPCs
            document.getElementById('calcCopies').value = bpcQuantity;
            document.getElementById('calcCopies').disabled = true;  // Lock quantity for BPCs

            // Calculate initial price
            calculatePrice();

            // Show modal
            document.getElementById('bpcCalculatorModal').style.display = 'block';
        }

        function calculatePrice() {
            if (!currentBlueprintTypeId) return;

            const pricing = bpcPricingData.find(p => p.blueprintTypeId === currentBlueprintTypeId);
            if (!pricing) return;

            const runs = parseInt(document.getElementById('calcRuns').value) || 1;
            const copies = parseInt(document.getElementById('calcCopies').value) || 1;

            // Calculate total price using the helper function from bpc_pricing_data.js
            if (typeof calculateBPCPrice === 'function') {
                const result = calculateBPCPrice(currentBlueprintTypeId, runs, copies);

                if (result) {
                    document.getElementById('calcTotalRuns').textContent = result.totalRuns;
                    document.getElementById('calcTotalPrice').textContent = formatISK(result.totalPrice);
                    document.getElementById('calcPricePerRun').textContent = formatISK(result.pricePerRun);
                }
            } else {
                // Fallback calculation
                const totalRuns = runs * copies;
                const totalPrice = pricing.pricePerRun * totalRuns;

                document.getElementById('calcTotalRuns').textContent = totalRuns;
                document.getElementById('calcTotalPrice').textContent = formatISK(totalPrice);
                document.getElementById('calcPricePerRun').textContent = formatISK(pricing.pricePerRun);
            }
        }

        function formatISK(amount) {
            if (amount >= 1_000_000_000) {
                return `${(amount / 1_000_000_000).toFixed(2)}B ISK`;
            } else if (amount >= 1_000_000) {
                return `${(amount / 1_000_000).toFixed(2)}M ISK`;
            } else if (amount >= 1_000) {
                return `${(amount / 1_000).toFixed(1)}k ISK`;
            } else {
                return `${amount.toFixed(0)} ISK`;
            }
        }

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            const modal = document.getElementById('bpcCalculatorModal');
            if (event.target === modal) {
                closeCalculator();
            }
        }

        // ============================================
        // BUYBACK PROGRAM
        // ============================================

        function renderBuybackRateCards() {
            if (typeof BUYBACK_DATA === 'undefined') return;

            const grid = document.getElementById('buybackRateGrid');
            if (!grid) return;

            // Group items by category
            const categoryGroups = {};
            BUYBACK_DATA.items.forEach(item => {
                if (!categoryGroups[item.category]) {
                    categoryGroups[item.category] = [];
                }
                categoryGroups[item.category].push(item);
            });

            // Determine default rate (most common rate) for "special" highlighting
            const allRates = BUYBACK_DATA.items.map(i => i.rate);
            const rateCount = {};
            allRates.forEach(r => { rateCount[r] = (rateCount[r] || 0) + 1; });
            const defaultRate = Object.entries(rateCount).sort((a, b) => b[1] - a[1])[0][0];

            // Render each category card
            const categoryOrder = ['minerals', 'ice_products', 'moon_materials'];
            categoryOrder.forEach(catKey => {
                const catConfig = BUYBACK_DATA.categories[catKey];
                const items = categoryGroups[catKey];
                if (!catConfig || !items) return;

                const card = document.createElement('div');
                card.className = 'rate-card' + (catConfig.visible ? '' : ' category-hidden');

                let itemsHtml = '';
                items.forEach(item => {
                    if (!item.accepted) {
                        itemsHtml += `
                            <div class="rate-item not-accepting">
                                <div class="rate-item-header">
                                    <span class="rate-item-name">${item.name}</span>
                                    <span class="not-accepting-badge">Not Accepting</span>
                                </div>
                            </div>`;
                        return;
                    }

                    const isSpecial = String(item.rate) !== String(defaultRate);
                    const pctClass = isSpecial ? 'rate-item-pct special' : 'rate-item-pct';

                    let quotaHtml = '';
                    if (item.quota > 0) {
                        const formatted = item.quota.toLocaleString();
                        let quotaClass = 'rate-item-quota';
                        if (item.quota <= 0) {
                            quotaClass += ' full';
                            quotaHtml = `<div class="${quotaClass}">Quota Full</div>`;
                        } else {
                            quotaHtml = `<div class="${quotaClass}">${formatted} remaining</div>`;
                        }
                    }

                    itemsHtml += `
                        <div class="rate-item">
                            <div class="rate-item-header">
                                <span class="rate-item-name">${item.name}</span>
                                <span class="${pctClass}">${item.rate}% JBV</span>
                            </div>
                            ${quotaHtml}
                        </div>`;
                });

                card.innerHTML = `
                    <div class="rate-card-title">${catConfig.displayName}</div>
                    <div class="rate-card-items">${itemsHtml}</div>`;

                grid.appendChild(card);
            });

            // Update grid columns: info card + visible categories
            const visibleCards = grid.querySelectorAll('.rate-card:not(.category-hidden)').length;
            grid.style.gridTemplateColumns = `repeat(${1 + visibleCards}, 1fr)`;
        }

        function parseEveInventory(text) {
            const lines = text.trim().split('\n');
            const items = [];

            lines.forEach(line => {
                line = line.trim();
                if (!line) return;

                // EVE copy formats: "ItemName\tQuantity" or "ItemName    Quantity"
                // Also handle "ItemName 1,000,000" with commas
                let match = line.match(/^(.+?)\t+(\d[\d,]*)/);
                if (!match) {
                    match = line.match(/^(.+?)\s{2,}(\d[\d,]*)/);
                }
                if (!match) {
                    // Try "Name quantity" with single space
                    match = line.match(/^(.+?)\s+(\d[\d,]*)$/);
                }

                if (match) {
                    const name = match[1].trim();
                    const qty = parseInt(match[2].replace(/,/g, ''));
                    if (qty > 0) {
                        items.push({ name, quantity: qty });
                    }
                }
            });

            return items;
        }

        function calculateBuybackQuote() {
            if (typeof BUYBACK_DATA === 'undefined') return;

            const textarea = document.getElementById('buybackPasteInput');
            const text = textarea.value.trim();
            if (!text) return;

            const parsedItems = parseEveInventory(text);
            if (parsedItems.length === 0) return;

            const results = [];
            let totalJita = 0;
            let totalPayout = 0;
            let acceptedCount = 0;
            let quotaWarnings = 0;

            parsedItems.forEach(parsed => {
                // Find matching buyback item (case-insensitive)
                const buybackItem = BUYBACK_DATA.items.find(
                    b => b.name.toLowerCase() === parsed.name.toLowerCase()
                );

                if (!buybackItem || !buybackItem.accepted) {
                    results.push({
                        name: parsed.name,
                        quantity: parsed.quantity,
                        accepted: false,
                        rate: 0,
                        jitaValue: 0,
                        payout: 0,
                        status: 'NOT ACCEPTED',
                        overLimit: false,
                    });
                    return;
                }

                let effectiveQty = parsed.quantity;
                let overLimit = false;
                let excessQty = 0;

                // Check quota
                if (buybackItem.quota > 0 && parsed.quantity > buybackItem.quota) {
                    excessQty = parsed.quantity - buybackItem.quota;
                    effectiveQty = buybackItem.quota;
                    overLimit = true;
                    quotaWarnings++;
                }

                const jitaValue = effectiveQty * buybackItem.avgJitaBuy;
                const payout = jitaValue * (buybackItem.rate / 100);

                totalJita += jitaValue;
                totalPayout += payout;
                acceptedCount++;

                results.push({
                    name: parsed.name,
                    quantity: parsed.quantity,
                    effectiveQty,
                    accepted: true,
                    rate: buybackItem.rate,
                    jitaValue,
                    payout,
                    status: overLimit ? 'PARTIAL' : 'ACCEPTED',
                    overLimit,
                    excessQty,
                    quota: buybackItem.quota,
                    typeId: buybackItem.typeId,
                });
            });

            // Render results
            renderBuybackResults(results, totalJita, totalPayout, acceptedCount, parsedItems.length, quotaWarnings);
        }

        function formatISKBuyback(value) {
            if (value >= 1e9) return (value / 1e9).toFixed(2) + 'B';
            if (value >= 1e6) return (value / 1e6).toFixed(2) + 'M';
            if (value >= 1e3) return (value / 1e3).toFixed(1) + 'k';
            return value.toFixed(0);
        }

        function renderBuybackResults(results, totalJita, totalPayout, acceptedCount, totalCount, quotaWarnings) {
            const tbody = document.getElementById('buybackResultsBody');
            tbody.innerHTML = '';

            results.forEach(r => {
                const row = document.createElement('tr');

                if (!r.accepted) {
                    row.style.opacity = '0.5';
                    row.innerHTML = `
                        <td class="item-name-col">${r.name}</td>
                        <td class="qty-col">${r.quantity.toLocaleString()}</td>
                        <td class="rate-col">--</td>
                        <td class="jita-col">--</td>
                        <td class="payout-col">--</td>
                        <td class="status-col"><span class="status-not-accepted">NOT ACCEPTED</span></td>`;
                } else if (r.overLimit) {
                    row.className = 'over-limit';
                    row.innerHTML = `
                        <td class="item-name-col">${r.name}<span class="over-limit-note">Capped at quota - ${r.excessQty.toLocaleString()} excess</span></td>
                        <td class="qty-col"><span class="qty-adjusted">${r.quantity.toLocaleString()}</span><span class="qty-accepted">${r.effectiveQty.toLocaleString()}</span></td>
                        <td class="rate-col">${r.rate}%</td>
                        <td class="jita-col">${formatISKBuyback(r.jitaValue)} ISK</td>
                        <td class="payout-col">${formatISKBuyback(r.payout)} ISK</td>
                        <td class="status-col"><span class="status-accepted" style="color:#ffaa00;">PARTIAL</span></td>`;
                } else {
                    row.innerHTML = `
                        <td class="item-name-col">${r.name}</td>
                        <td class="qty-col">${r.quantity.toLocaleString()}</td>
                        <td class="rate-col">${r.rate}%</td>
                        <td class="jita-col">${formatISKBuyback(r.jitaValue)} ISK</td>
                        <td class="payout-col">${formatISKBuyback(r.payout)} ISK</td>
                        <td class="status-col"><span class="status-accepted">ACCEPTED</span></td>`;
                }

                tbody.appendChild(row);
            });

            // Summary
            const summaryDiv = document.getElementById('buybackSummary');
            let summaryHtml = `
                <div class="summary-item">
                    <div class="summary-label">Accepted Items</div>
                    <div class="summary-value items-count">${acceptedCount} / ${totalCount}</div>
                </div>`;

            if (quotaWarnings > 0) {
                summaryHtml += `
                    <div class="summary-item">
                        <div class="summary-label">Quota Warnings</div>
                        <div class="summary-value" style="color:#ffaa00; text-shadow:0 0 10px rgba(255,170,0,0.4);">${quotaWarnings} item${quotaWarnings > 1 ? 's' : ''} capped</div>
                    </div>`;
            }

            summaryHtml += `
                <div class="summary-item">
                    <div class="summary-label">Total Jita Value</div>
                    <div class="summary-value items-count">${formatISKBuyback(totalJita)} ISK</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Your Payout</div>
                    <div class="summary-value">${formatISKBuyback(totalPayout)} ISK</div>
                </div>`;

            summaryDiv.innerHTML = summaryHtml;

            // Build share link
            const acceptedItems = results.filter(r => r.accepted);
            const itemPairs = acceptedItems.map(r => `${r.typeId}:${r.quantity}`).join(',');
            const shareUrl = `${window.location.origin}${window.location.pathname}#buyback=${itemPairs}`;
            document.getElementById('buybackQuoteLinkInput').value = shareUrl;

            // Generate quote ID from hash
            const quoteHash = itemPairs.split('').reduce((h, c) => ((h << 5) - h + c.charCodeAt(0)) | 0, 0);
            const quoteId = 'BB-' + Math.abs(quoteHash).toString(16).toUpperCase().slice(0, 6).padStart(6, '0');
            document.getElementById('buybackQuoteId').textContent = quoteId;

            // Timestamp
            const now = new Date();
            const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
            document.getElementById('buybackQuoteTimestamp').textContent =
                `Generated: ${months[now.getUTCMonth()]} ${now.getUTCDate()}, ${now.getUTCFullYear()} ${String(now.getUTCHours()).padStart(2,'0')}:${String(now.getUTCMinutes()).padStart(2,'0')} EVE`;

            // Show results
            document.getElementById('buybackResults').classList.add('visible');
        }

        function clearBuybackInput() {
            document.getElementById('buybackPasteInput').value = '';
            document.getElementById('buybackResults').classList.remove('visible');
            document.getElementById('buybackResultsBody').innerHTML = '';
        }

        function copyBuybackQuoteLink() {
            const input = document.getElementById('buybackQuoteLinkInput');
            input.select();
            navigator.clipboard.writeText(input.value).then(() => {
                const btn = document.getElementById('buybackCopyLinkBtn');
                btn.textContent = 'Copied!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'Copy Link';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        function loadBuybackFromHash() {
            const hash = window.location.hash;
            if (!hash.startsWith('#buyback=')) return;

            const itemsStr = hash.replace('#buyback=', '');
            const pairs = itemsStr.split(',');

            if (typeof BUYBACK_DATA === 'undefined') return;

            // Build text from type IDs
            const lines = [];
            pairs.forEach(pair => {
                const [typeId, qty] = pair.split(':').map(Number);
                const item = BUYBACK_DATA.items.find(b => b.typeId === typeId);
                if (item && qty > 0) {
                    lines.push(`${item.name}\t${qty}`);
                }
            });

            if (lines.length > 0) {
                // Show loaded banner
                document.getElementById('buybackLoadedBanner').style.display = 'flex';
                const quoteHash = itemsStr.split('').reduce((h, c) => ((h << 5) - h + c.charCodeAt(0)) | 0, 0);
                document.getElementById('buybackLoadedQuoteId').textContent =
                    'BB-' + Math.abs(quoteHash).toString(16).toUpperCase().slice(0, 6).padStart(6, '0');

                // Fill textarea and calculate
                document.getElementById('buybackPasteInput').value = lines.join('\n');

                // Switch to buyback tab
                showMainTab('buyback');
                document.querySelectorAll('.main-tab').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.textContent.includes('Buyback')) btn.classList.add('active');
                });

                calculateBuybackQuote();
            }
        }

        // ============================================
        // INITIALIZATION
        // ============================================

        document.addEventListener('DOMContentLoaded', function() {
            loadInventoryData();
            loadBlueprintData();
            loadBPCData();  // Load BPC data for BPC tab
            loadResearchJobs();
            loadLastUpdated();
            renderBuybackRateCards();
            loadBuybackFromHash();

            // Auto-expand inventory on page load (skip landing page)
            expandInventory();
        });
    </script>
</body>
</html>
